<!DOCTYPE html>
<html lang="en-255" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="generator" content="Hugo 0.101.0">
    <meta name="generator" content="Relearn 5.8.1+tip">
    <meta name="robots" content="noindex, nofollow, noarchive, noimageindex">
    <meta name="description" content="">
    <title>User Access Node (UAN)</title>
    <!-- https://github.com/filamentgroup/loadCSS/blob/master/README.md#how-to-use -->
    <link href="/docs-uan/css/fontawesome-all.min.css?1670952041" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/docs-uan/css/fontawesome-all.min.css?1670952041" rel="stylesheet"></noscript>
    <link href="/docs-uan/css/featherlight.min.css?1670952041" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/docs-uan/css/featherlight.min.css?1670952041" rel="stylesheet"></noscript>
    <link href="/docs-uan/css/auto-complete.css?1670952041" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/docs-uan/css/auto-complete.css?1670952041" rel="stylesheet"></noscript>
    <link href="/docs-uan/css/perfect-scrollbar.min.css?1670952041" rel="stylesheet">
    <link href="/docs-uan/css/nucleus.css?1670952041" rel="stylesheet">
    <link href="/docs-uan/css/fonts.css?1670952041" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/docs-uan/css/fonts.css?1670952041" rel="stylesheet"></noscript>
    <link href="/docs-uan/css/theme.css?1670952041" rel="stylesheet">
    <link href="/docs-uan/css/theme-green.css?1670952041" rel="stylesheet" id="variant-style">
    <link href="/docs-uan/css/ie.css?1670952041" rel="stylesheet">
    <link href="/docs-uan/css/variant.css?1670952041" rel="stylesheet">
    <link href="/docs-uan/css/print.css?1670952041" rel="stylesheet" media="print">
    <script src="/docs-uan/js/url.js?1670952041"></script>
    <script src="/docs-uan/js/variant.js?1670952041"></script>
    <script>
      // hack to let hugo tell us how to get to the root when using relativeURLs, it needs to be called *url= for it to do its magic:
      // https://github.com/gohugoio/hugo/blob/145b3fcce35fbac25c7033c91c1b7ae6d1179da8/transform/urlreplacers/absurlreplacer.go#L72
      window.index_js_url="/docs-uan/index.search.js";
      var root_url="/";
      var baseUri=root_url.replace(/\/$/, '');
      // translations
      window.T_Copy_to_clipboard = '';
      window.T_Copied_to_clipboard = '';
      window.T_Copy_link_to_clipboard = '';
      window.T_Link_copied_to_clipboard = '';
      window.T_No_results_found = '';
      window.T_N_results_found = '';
      // some further base stuff
      var baseUriFull='docs-uan/';
      window.variants && variants.init( [ 'green' ] );
    </script>
    <script src="/docs-uan/js/jquery.min.js?1670952041" defer></script>
  </head>
  <body class="mobile-support html" data-url="/docs-uan/troubleshooting/troubleshoot_uan_boot_issues/index.html">
    <div id="body" class="default-animation">
      <div id="sidebar-overlay"></div>
      <div id="toc-overlay"></div>
      <nav id="topbar" class="highlightable" dir="ltr">
        <div>
          <div id="breadcrumbs">
            <span id="sidebar-toggle-span">
              <a href="#" id="sidebar-toggle" title=' (CTRL+ALT+n)'><i class="fas fa-bars fa-fw"></i></a>
            </span>
            <span id="toc-menu" title=' (CTRL+ALT+t)'><i class="fas fa-list-alt fa-fw"></i></span>
            <span class="links">
              
            </span>
          </div>
          <div class="default-animation progress">
            <div class="toc-wrapper" dir="ltr">
<nav id="TableOfContents">
  <ul>
    <li><a href="#the-uan-boot-process">The UAN boot process</a></li>
    <li><a href="#pxe-issues">PXE Issues</a></li>
    <li><a href="#initrd-dracut-issues">Initrd (Dracut) Issues</a></li>
    <li><a href="#image-boot-issues">Image Boot Issues</a></li>
  </ul>
</nav>
            </div>
          </div>
        </div>
      </nav>
      <main id="body-inner" class="highlightable default" tabindex="-1">
        <div class="flex-block-wrapper">
          <div id="head-tags">
          </div>
          <article class="default">
<h1 id=""></h1>

<h1 id="troubleshoot-uan-boot-issues">Troubleshoot UAN Boot Issues</h1>
<h2 id="the-uan-boot-process">The UAN boot process</h2>
<p>BOS boots UANs. BOS uses session templates to define various parameters such as:</p>
<ul>
<li>Which nodes to boot</li>
<li>Which image to boot</li>
<li>Kernel parameters</li>
<li>Whether to perform post-boot configuration (Node Personalization) of the nodes by CFS.</li>
<li>Which CFS configuration to use if Node Personalization is enabled.</li>
</ul>
<p>UAN boots are performed in three phases:</p>
<ol>
<li>PXE booting an iPXE binary that will load the initrd of the UAN image that will boot.</li>
<li>Booting the initrd (dracut) image which configures the UAN for booting the UAN image. This process consists of two phases.
<ol>
<li>Configuring the UAN node to use the Content Projection Service (CPS) and Data Virtualization Service (DVS). These services manage the UAN image rootfs mounting and make that image available to the UAN nodes.</li>
<li>Mounting the rootfs</li>
</ol>
</li>
<li>Booting the UAN image rootfs.</li>
</ol>
<h2 id="pxe-issues">PXE Issues</h2>
<p>Most PXE boot failures are the result of misconfigured network switches and/or BIOS settings. The UAN must PXE boot over the Node Management Network (NMN) and the switches must be configured to allow connectivity to the NMN. The cable for the NMN must be connected to the first port of the OCP card on HPE DL325 and DL385 servers or to the first port of the built-in LAN-On-Motherboard (LOM) on Gigabyte servers. See &ldquo;Prepare for UAN Product Installation&rdquo; in the UAN Installation Guide for details on the switch and BIOS settings required to configure the UAN for PXE booting.</p>
<p>UANs may fail to boot when the BIOS EFITIME is too far away from the time on management nodes. If there are x509 certificate problems, check that the BIOS time is correct. See &ldquo;Configure the BIOS of an HPE UAN&rdquo; or &ldquo;Configure the BIOS of a Gigabyte UAN&rdquo; in the UAN Installation Guide for examples of checking settings in the BIOS.</p>
<h2 id="initrd-dracut-issues">Initrd (Dracut) Issues</h2>
<p>Dracut failures are often caused by the wrong interface being named <code>nmn0</code>, or to multiple entries for the UAN xname in DNS. The latter is a result of multiple interfaces making DHCP requests. Either condition can cause IP address mismatches in the <code>dvs_node_map</code>. DNS configures entries based on DHCP leases.</p>
<p>When dracut starts, it renames the network device named by the <code>ifmap=netX:nmn0</code> kernel parameter to <code>nmn0</code>. This interface is the only one dracut will enable DHCP on. The <code>ip=nmn0:dhcp</code> kernel parameter limits dracut to DHCP only <code>nmn0</code>. The ifmap value must be set correctly in the <code>kernel_parameters</code> field of the BOS session template.</p>
<p>See <a href="/docs-uan/operations/create_uan_boot_images/#create-uan-boot-images">Create UAN Boot Images</a> for details on how to configure the BOS session template. For UAN nodes that have more than one PCI card installed, <code>ifmap=net2:nmn0</code> is the correct setting. If only one PCI card is installed, <code>ifmap=net0:nmn0</code> is normally the correct setting.</p>
<p>UANs require CPS and DVS to boot from images. These services are configured in dracut to retrieve the rootfs and mount it. If the image fails to download, check that DVS and CPS are both healthy, and DVS is running on all worker nodes. Run the following commands to check DVS and CPS:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ncn-m001#  kubectl get nodes -l cps-pm-node<span style="color:#f92672">=</span>True -o custom-columns<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;:metadata.name&#34;</span> --no-headers
</span></span><span style="display:flex;"><span>ncn-w001
</span></span><span style="display:flex;"><span>ncn-w002
</span></span><span style="display:flex;"><span>ncn-m001#  <span style="color:#66d9ef">for</span> node in <span style="color:#e6db74">`</span>kubectl get nodes -l cps-pm-node<span style="color:#f92672">=</span>True -o custom-columns<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;:metadata.name&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--no-headers<span style="color:#e6db74">`</span>; <span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>ssh $node <span style="color:#e6db74">&#34;lsmod | grep &#39;^dvs &#39;&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">done</span>
</span></span><span style="display:flex;"><span>ncn-w001
</span></span><span style="display:flex;"><span>ncn-w002
</span></span></code></pre></div><p>If DVS and CPS are both healthy, then both of these commands will return all the worker NCNs in the HPE Cray EX system.</p>
<h2 id="image-boot-issues">Image Boot Issues</h2>
<p>Once dracut exits, the UAN will boot the <code>rootfs</code> image. Failures seen in this phase tend to be failures of <code>spire-agent</code>, <code>cfs-state-reporter</code>, or both. The <code>cfs-state-reporter</code> tells BOA that the node is ready and allows BOA to start CFS for Node Personalization. If <code>cfs-state-reporter</code> does not start, check if the <code>spire-agent</code> has started. The <code>cfs-state-reporter</code> depends on the <code>spire-agent</code>. Running systemctl status spire-agent will show that that service is enabled and running if there are no issues with that service. Similarly, running <code>systemctl status cfs-state-reporter</code> will show a status of SUCCESS.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>uan# systemctl status spire-agent
</span></span><span style="display:flex;"><span>● spire-agent.service - SPIRE Agent
</span></span><span style="display:flex;"><span>   Loaded: loaded <span style="color:#f92672">(</span>/usr/lib/systemd/system/spire-agent.service; enabled; vendor preset: enabled<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>   Active: active <span style="color:#f92672">(</span>running<span style="color:#f92672">)</span> since Wed 2021-02-24 14:27:33 CST; 19h ago
</span></span><span style="display:flex;"><span> Main PID: <span style="color:#ae81ff">3581</span> <span style="color:#f92672">(</span>spire-agent<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>    Tasks: <span style="color:#ae81ff">57</span>
</span></span><span style="display:flex;"><span>   CGroup: /system.slice/spire-agent.service
</span></span><span style="display:flex;"><span>           └─3581 /usr/bin/spire-agent run -expandEnv -config /root/spire/conf/spire-agent.conf
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>uan# systemctl status cfs-state-reporter
</span></span><span style="display:flex;"><span>● cfs-state-reporter.service - cfs-state-reporter reports configuration level of the system
</span></span><span style="display:flex;"><span>   Loaded: loaded <span style="color:#f92672">(</span>/usr/lib/systemd/system/cfs-state-reporter.service; enabled; vendor preset: enabled<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>   Active: inactive <span style="color:#f92672">(</span>dead<span style="color:#f92672">)</span> since Wed 2021-02-24 14:29:51 CST; 19h ago
</span></span><span style="display:flex;"><span> Main PID: <span style="color:#ae81ff">3827</span> <span style="color:#f92672">(</span>code<span style="color:#f92672">=</span>exited, status<span style="color:#f92672">=</span>0/SUCCESS<span style="color:#f92672">)</span>
</span></span></code></pre></div><p>There may be errors related to failing to load kernel modules during the boot:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>FAILED Failed to start Load Kernel Modules.
</span></span><span style="display:flex;"><span>See <span style="color:#e6db74">&#39;systemctl status systemd-modules-load.service&#39;</span> <span style="color:#66d9ef">for</span> details.
</span></span></code></pre></div><p>Provided the UAN boots and completes post boot customizations, these messages may be ignored.</p>

            <footer class="footline">
            </footer>
          </article>
        </div>
      </main>
    </div>
    <aside id="sidebar" class="default-animation" dir="ltr">
      <div id="header-wrapper" class="default-animation">
        <div id="header" class="default-animation">
<a id="logo" href='/docs-uan/'>
  <img src="/docs-uan/images/hpe.png" alt="HPE" />
</a>
        </div>
        <div class="searchbox default-animation">
          <i class="fas fa-search" title=" (CTRL+ALT+f)"></i>
          <label class="a11y-only" for="search-by"></label>
          <input data-search-input id="search-by" name="search-by" class="search-by" type="search" placeholder="">
          <span data-search-clear=""><i class="fas fa-times"></i></span>
        </div>
        <script>
          var contentLangs=['en'];
        </script>
        <script src="/docs-uan/js/auto-complete.js?1670952041" defer></script>
        <script src="/docs-uan/js/lunr.min.js?1670952041" defer></script>
        <script src="/docs-uan/js/lunr.stemmer.support.min.js?1670952041" defer></script>
        <script src="/docs-uan/js/lunr.multi.min.js?1670952041" defer></script>
        <script src="/docs-uan/js/lunr.en.min.js?1670952041" defer></script>
        <script src="/docs-uan/js/search.js?1670952041" defer></script>
      </div>
      <div id="content-wrapper" class="highlightable">
        <ul class="topics">
          <li data-nav-id="/docs-uan/troubleshooting/index.html" class="dd-item parent"><a href="/docs-uan/troubleshooting/index.html">Troubleshooting</a><ul id="subsections-a56d73db870866a7a123242f91a0cee2">
          <li data-nav-id="/docs-uan/troubleshooting/troubleshoot_uan_boot_issues/index.html" class="dd-item active"><a href="/docs-uan/troubleshooting/troubleshoot_uan_boot_issues/index.html">Troubleshoot UAN Boot Issues</a></li></ul></li>
        </ul>
        <div class="footermargin footerLangSwitch footerVariantSwitch footerVisitedLinks footerFooter showFooter"></div>
        <hr class="default-animation footerLangSwitch footerVariantSwitch footerVisitedLinks footerFooter showFooter">
        <div id="prefooter" class="footerLangSwitch footerVariantSwitch footerVisitedLinks">
          <ul>
            <li id="select-language-container" class="footerLangSwitch">
              <div class="padding select-container">
                <i class="fas fa-language fa-fw"></i>
                <span>&nbsp;</span>
                <div class="select-style">
                  <label class="a11y-only" for="select-language"></label>
                  <select id="select-language" onchange="location = baseUri + this.value;">
                  </select>
                </div>
                <div class="select-clear"></div>
              </div>
            </li>
            <li id="select-variant-container" class="footerVariantSwitch">
              <div class="padding select-container">
                <i class="fas fa-paint-brush fa-fw"></i>
                <span>&nbsp;</span>
                <div class="select-style">
                  <label class="a11y-only" for="select-variant"></label>
                  <select id="select-variant" onchange="window.variants && variants.changeVariant( this.value );">
                    <option id="green" value="green" selected>Green</option>
                  </select>
                </div>
                <div class="select-clear"></div>
              </div>
              <script>window.variants && variants.markSelectedVariant();</script>
            </li>
            <li class="footerVisitedLinks"><button class="padding" onclick="clearHistory();"><i class="fas fa-history fa-fw"></i> </button></li>
          </ul>
        </div>
        <div id="footer" class="footerFooter showFooter">
	    <p>Built with <a href="https://github.com/McShelby/hugo-theme-relearn" title="love"><i class="fas fa-heart"></i></a> by <a href="https://gohugo.io/">Hugo</a></p>
        </div>
      </div>
    </aside>
    <script src="/docs-uan/js/clipboard.min.js?1670952041" defer></script>
    <script src="/docs-uan/js/perfect-scrollbar.min.js?1670952041" defer></script>
    <script src="/docs-uan/js/featherlight.min.js?1670952041" defer></script>
    <script src="/docs-uan/js/theme.js?1670952041" defer></script>
  </body>
</html>
