<!DOCTYPE html>
<html lang="en-255" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="generator" content="Hugo 0.101.0">
    <meta name="generator" content="Relearn 5.8.1+tip">
    <meta name="robots" content="noindex, nofollow, noarchive, noimageindex">
    <meta name="description" content="">
    <title>User Access Node (UAN)</title>
    <!-- https://github.com/filamentgroup/loadCSS/blob/master/README.md#how-to-use -->
    <link href="/docs-uan/css/fontawesome-all.min.css?1670952041" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/docs-uan/css/fontawesome-all.min.css?1670952041" rel="stylesheet"></noscript>
    <link href="/docs-uan/css/featherlight.min.css?1670952041" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/docs-uan/css/featherlight.min.css?1670952041" rel="stylesheet"></noscript>
    <link href="/docs-uan/css/auto-complete.css?1670952041" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/docs-uan/css/auto-complete.css?1670952041" rel="stylesheet"></noscript>
    <link href="/docs-uan/css/perfect-scrollbar.min.css?1670952041" rel="stylesheet">
    <link href="/docs-uan/css/nucleus.css?1670952041" rel="stylesheet">
    <link href="/docs-uan/css/fonts.css?1670952041" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/docs-uan/css/fonts.css?1670952041" rel="stylesheet"></noscript>
    <link href="/docs-uan/css/theme.css?1670952041" rel="stylesheet">
    <link href="/docs-uan/css/theme-green.css?1670952041" rel="stylesheet" id="variant-style">
    <link href="/docs-uan/css/ie.css?1670952041" rel="stylesheet">
    <link href="/docs-uan/css/variant.css?1670952041" rel="stylesheet">
    <link href="/docs-uan/css/print.css?1670952041" rel="stylesheet" media="print">
    <script src="/docs-uan/js/url.js?1670952041"></script>
    <script src="/docs-uan/js/variant.js?1670952041"></script>
    <script>
      // hack to let hugo tell us how to get to the root when using relativeURLs, it needs to be called *url= for it to do its magic:
      // https://github.com/gohugoio/hugo/blob/145b3fcce35fbac25c7033c91c1b7ae6d1179da8/transform/urlreplacers/absurlreplacer.go#L72
      window.index_js_url="/docs-uan/index.search.js";
      var root_url="/";
      var baseUri=root_url.replace(/\/$/, '');
      // translations
      window.T_Copy_to_clipboard = '';
      window.T_Copied_to_clipboard = '';
      window.T_Copy_link_to_clipboard = '';
      window.T_Link_copied_to_clipboard = '';
      window.T_No_results_found = '';
      window.T_N_results_found = '';
      // some further base stuff
      var baseUriFull='docs-uan/';
      window.variants && variants.init( [ 'green' ] );
    </script>
    <script src="/docs-uan/js/jquery.min.js?1670952041" defer></script>
  </head>
  <body class="mobile-support html" data-url="/docs-uan/advanced/repurposing_compute_as_uan/index.html">
    <div id="body" class="default-animation">
      <div id="sidebar-overlay"></div>
      <div id="toc-overlay"></div>
      <nav id="topbar" class="highlightable" dir="ltr">
        <div>
          <div id="breadcrumbs">
            <span id="sidebar-toggle-span">
              <a href="#" id="sidebar-toggle" title=' (CTRL+ALT+n)'><i class="fas fa-bars fa-fw"></i></a>
            </span>
            <span id="toc-menu" title=' (CTRL+ALT+t)'><i class="fas fa-list-alt fa-fw"></i></span>
            <span class="links">
              
            </span>
          </div>
          <div class="default-animation progress">
            <div class="toc-wrapper" dir="ltr">
<nav id="TableOfContents">
  <ul>
    <li><a href="#overview">Overview</a></li>
    <li><a href="#prerequisites">Prerequisites</a></li>
    <li><a href="#procedure">Procedure</a></li>
    <li><a href="#verification-as-a-uan">Verification as a UAN</a>
      <ul>
        <li><a href="#basic-uan-configuration-checks">Basic UAN Configuration Checks</a></li>
        <li><a href="#common-uan-configuration-checks">Common UAN Configuration Checks</a></li>
        <li><a href="#verify-users-can-login">Verify Users can Login</a></li>
      </ul>
    </li>
  </ul>
</nav>
            </div>
          </div>
        </div>
      </nav>
      <main id="body-inner" class="highlightable default" tabindex="-1">
        <div class="flex-block-wrapper">
          <div id="head-tags">
          </div>
          <article class="default">
<h1 id=""></h1>

<h1 id="repurposing-a-compute-node-as-a-uan">Repurposing a Compute Node as a UAN</h1>
<p>This section describes how to repurpose a compute node to be used as a User Access Node (UAN).  This is typically done when the processor type of the compute node is not yet available in a UAN server.</p>
<h2 id="overview">Overview</h2>
<p>The following steps outline the process of repurposing a compute node to be used as a UAN.</p>
<ol>
<li>
<p>Verify the System Default Route is set to <code>CHN</code>.</p>
</li>
<li>
<p>Change the role of the compute node in the Hardware State Manager from <code>Compute</code> to <code>Application</code> and set the sub-role to <code>UAN</code>.</p>
</li>
<li>
<p>Ensure that IPs on the CHN exist for the computes nodes in SLS.</p>
</li>
<li>
<p>Boot the repurposed compute node as a UAN.</p>
</li>
<li>
<p>Verify the repurposed compute node functions as a UAN.</p>
</li>
</ol>
<h2 id="prerequisites">Prerequisites</h2>
<p>There are no changes needed in hardware, network cabling, or UEFI/BIOS/BMC configuration to repurpose a compute node for use as a UAN.  However, compute nodes do not have the necessary network interface cards to support user access over the Customer Access Network (CAN). Additionally, the network configuration of Mountain Cabinets do not support the CAN network. Therefore, repurposing a compute node as a UAN requires the system to be configured to use the Customer High-Speed Network (CHN) and that the compute nodes have a CHN IP address in SLS.</p>
<ul>
<li>The SLS Networks setting for the <code>SystemDefaultRoute</code> must be <code>CHN</code></li>
<li>The repurposed compute nodes must have CHN IP addresses in SLS</li>
<li><code>uan_can_setup</code> must be set to <code>true</code> in the uan-config-management repo</li>
</ul>
<h2 id="procedure">Procedure</h2>
<p>Perform the following steps to repurpose a compute node for use as a UAN.</p>
<ol>
<li>
<p>Log in to the master node <code>ncn-m001</code>. All commands in this procedure are run from the master node.</p>
</li>
<li>
<p>Verify the system is configured to use the <code>CHN</code> as the System Default Route. If the <code>SystemDefaultRoute</code> is not <code>CHN</code>, the compute nodes may not be repurposed as UAN.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ncn-m001# cray sls networks describe BICAN  --format json | jq -r <span style="color:#e6db74">&#39;.ExtraProperties.SystemDefaultRoute&#39;</span>
</span></span></code></pre></div></li>
<li>
<p>Verify a CHN IP address exists in SLS for each repurposed compute node. Repeat the following command and replace <code>&lt;XNAME&gt;</code> with the xname of each repurposed compute node. The compute node must have a CHN IP address in SLS or it cannot be repurposed as a UAN.  See <code>Add Compute IP addresses to CHN SLS data</code> section of the Cray System Management documentation for information on adding compute nodes to the CHN.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ncn-m001# cray sls networks describe CHN | q -r <span style="color:#e6db74">&#39;.ExtraProperties.Subnets[] | select(.FullName == &#34;CHN Bootstrap DHCP Subnet&#34;) | .IPReservations[] | select(.Comment == &#34;&lt;XNAME&gt;&#34;)&#39;</span>
</span></span></code></pre></div></li>
<li>
<p>Verify that <code>uan_can_setup: true</code> is set in the <code>uan-config-management</code> CFS repo.  See <a href="/docs-uan/advanced/enabling_can_chn/">Enabling the Customer Access Network (CAN) or the Customer High Speed Network (CHN)</a> for more information.</p>
</li>
<li>
<p>Change the role and sub-role in HSM of the compute node(s) being repurposed as UANs to <code>Application</code> and <code>UAN</code>, respectively.  Repeat the following command and replace <code>&lt;XNAME&gt;</code> with the xname of each repurposed compute node.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ncn-m001# cray hsm state components role update --role Application --sub-role UAN &lt;XNAME&gt;
</span></span></code></pre></div></li>
<li>
<p>Verify the role and sub-role in HSM of the repurposed compute node(s) has been changed to &lsquo;Application<code> and 'UAN</code>, respectively.  Repeat the following command and replace <code>&lt;XNAME&gt;</code> with the xname of each repurposed compute node.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ncn-m001# cray hsm state components describe &lt;XNAME&gt;
</span></span></code></pre></div></li>
<li>
<p>Run the BOS session template used to boot the UAN nodes. See <a href="/docs-uan/operations/boot_uans/">Boot UAN Nodes</a> for more information on booting UAN nodes with BOS.  Replace <code>&lt;UAN_SESSIONTEMPLATE&gt;</code> with the name of the BOS session template used to boot the UAN nodes and <code>&lt;XNAME&gt;</code> with the xname of the repurposed compute node.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ncn-m001# cray bos session create --template-uuid &lt;UAN_SESSIONTEMPLATE&gt; --operation reboot --limit &lt;XNAME&gt;
</span></span></code></pre></div></li>
</ol>
<h2 id="verification-as-a-uan">Verification as a UAN</h2>
<p>Once the repurposed compute node is booted as a UAN, the following steps will verify it is configured as a UAN. These steps may vary dependent upon how the site has configured the UAN nodes.</p>
<h3 id="basic-uan-configuration-checks">Basic UAN Configuration Checks</h3>
<ol>
<li>
<p>Verify the repurposed compute node has finished the configuration phase. The output should &ldquo;configured&rdquo;.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ncn-m001# cray cfs components describe &lt;XNAME&gt; --format json | jq -r .configurationStatus
</span></span></code></pre></div></li>
<li>
<p>Login to the repurposed compute node from the master node <code>ncn-m001</code> as the root user.</p>
</li>
<li>
<p>Verify that the <code>hsn0</code> interface has the CHN IP address assigned to it in SLS.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>uan# ip a | grep hsn0
</span></span></code></pre></div></li>
<li>
<p>Verify the default route is via <code>hsn0</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>uan# ip r | grep default
</span></span></code></pre></div></li>
<li>
<p>Verify that all site UAN filesystems are mounted.</p>
</li>
</ol>
<h3 id="common-uan-configuration-checks">Common UAN Configuration Checks</h3>
<ol>
<li>
<p>If LDAP is used for user authentication, verify the LDAP service is reachable.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>uan# ping &lt;ldap_service_ip&gt;
</span></span></code></pre></div></li>
<li>
<p>If SLURM is used, test <code>sinfo</code> and <code>srun</code> commands.  This example <code>srun</code> command should return the hostname of 4 compute nodes.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>uan# sinfo
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>uan# srun -N4 hostname
</span></span></code></pre></div></li>
</ol>
<h3 id="verify-users-can-login">Verify Users can Login</h3>
<ol>
<li>
<p>Login to the repurposed compute node as an authorized non-root user from any host that should have UAN access.</p>
</li>
<li>
<p>If SLURM is used, test <code>sinfo</code> and <code>srun</code> commands.  This example <code>srun</code> command should return the hostname of 4 compute nodes.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>uan# sinfo
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>uan# srun -N4 hostname
</span></span></code></pre></div></li>
</ol>

            <footer class="footline">
            </footer>
          </article>
        </div>
      </main>
    </div>
    <aside id="sidebar" class="default-animation" dir="ltr">
      <div id="header-wrapper" class="default-animation">
        <div id="header" class="default-animation">
<a id="logo" href='/docs-uan/'>
  <img src="/docs-uan/images/hpe.png" alt="HPE" />
</a>
        </div>
        <div class="searchbox default-animation">
          <i class="fas fa-search" title=" (CTRL+ALT+f)"></i>
          <label class="a11y-only" for="search-by"></label>
          <input data-search-input id="search-by" name="search-by" class="search-by" type="search" placeholder="">
          <span data-search-clear=""><i class="fas fa-times"></i></span>
        </div>
        <script>
          var contentLangs=['en'];
        </script>
        <script src="/docs-uan/js/auto-complete.js?1670952041" defer></script>
        <script src="/docs-uan/js/lunr.min.js?1670952041" defer></script>
        <script src="/docs-uan/js/lunr.stemmer.support.min.js?1670952041" defer></script>
        <script src="/docs-uan/js/lunr.multi.min.js?1670952041" defer></script>
        <script src="/docs-uan/js/lunr.en.min.js?1670952041" defer></script>
        <script src="/docs-uan/js/search.js?1670952041" defer></script>
      </div>
      <div id="content-wrapper" class="highlightable">
        <ul class="topics">
          <li data-nav-id="/docs-uan/advanced/index.html" class="dd-item parent"><a href="/docs-uan/advanced/index.html">Advanced</a><ul id="subsections-3b2f960022364262aad3600bb7df4641">
          <li data-nav-id="/docs-uan/advanced/repurposing_compute_as_uan/index.html" class="dd-item active"><a href="/docs-uan/advanced/repurposing_compute_as_uan/index.html">Repurposing A Compute Node As A UAN</a></li></ul></li>
        </ul>
        <div class="footermargin footerLangSwitch footerVariantSwitch footerVisitedLinks footerFooter showFooter"></div>
        <hr class="default-animation footerLangSwitch footerVariantSwitch footerVisitedLinks footerFooter showFooter">
        <div id="prefooter" class="footerLangSwitch footerVariantSwitch footerVisitedLinks">
          <ul>
            <li id="select-language-container" class="footerLangSwitch">
              <div class="padding select-container">
                <i class="fas fa-language fa-fw"></i>
                <span>&nbsp;</span>
                <div class="select-style">
                  <label class="a11y-only" for="select-language"></label>
                  <select id="select-language" onchange="location = baseUri + this.value;">
                  </select>
                </div>
                <div class="select-clear"></div>
              </div>
            </li>
            <li id="select-variant-container" class="footerVariantSwitch">
              <div class="padding select-container">
                <i class="fas fa-paint-brush fa-fw"></i>
                <span>&nbsp;</span>
                <div class="select-style">
                  <label class="a11y-only" for="select-variant"></label>
                  <select id="select-variant" onchange="window.variants && variants.changeVariant( this.value );">
                    <option id="green" value="green" selected>Green</option>
                  </select>
                </div>
                <div class="select-clear"></div>
              </div>
              <script>window.variants && variants.markSelectedVariant();</script>
            </li>
            <li class="footerVisitedLinks"><button class="padding" onclick="clearHistory();"><i class="fas fa-history fa-fw"></i> </button></li>
          </ul>
        </div>
        <div id="footer" class="footerFooter showFooter">
	    <p>Built with <a href="https://github.com/McShelby/hugo-theme-relearn" title="love"><i class="fas fa-heart"></i></a> by <a href="https://gohugo.io/">Hugo</a></p>
        </div>
      </div>
    </aside>
    <script src="/docs-uan/js/clipboard.min.js?1670952041" defer></script>
    <script src="/docs-uan/js/perfect-scrollbar.min.js?1670952041" defer></script>
    <script src="/docs-uan/js/featherlight.min.js?1670952041" defer></script>
    <script src="/docs-uan/js/theme.js?1670952041" defer></script>
  </body>
</html>
