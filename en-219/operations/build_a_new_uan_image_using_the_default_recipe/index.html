<!DOCTYPE html>
<html lang="en-219" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.87.0" />
    <meta name="description" content="">


    <link rel="icon" href="/docs-uan/images/favicon.png" type="image/png">

    <title>Build A New UAN Image Using The Default Recipe :: User Access Node (UAN)</title>

    
    <link href="/docs-uan/css/nucleus.css?1644019530" rel="stylesheet">
    <link href="/docs-uan/css/fontawesome-all.min.css?1644019530" rel="stylesheet">
    <link href="/docs-uan/css/hybrid.css?1644019530" rel="stylesheet">
    <link href="/docs-uan/css/featherlight.min.css?1644019530" rel="stylesheet">
    <link href="/docs-uan/css/perfect-scrollbar.min.css?1644019530" rel="stylesheet">
    <link href="/docs-uan/css/auto-complete.css?1644019530" rel="stylesheet">
    <link href="/docs-uan/css/atom-one-dark-reasonable.css?1644019530" rel="stylesheet">
    <link href="/docs-uan/css/theme.css?1644019530" rel="stylesheet">
    <link href="/docs-uan/css/tabs.css?1644019530" rel="stylesheet">
    <link href="/docs-uan/css/hugo-theme.css?1644019530" rel="stylesheet">
    
    <link href="/docs-uan/css/theme-blue.css?1644019530" rel="stylesheet">
    
    

    <script src="/docs-uan/js/jquery-3.3.1.min.js?1644019530"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
    </style>
    
  </head>
  <body class="" data-url="/docs-uan/en-219/operations/build_a_new_uan_image_using_the_default_recipe/">
    <nav id="sidebar" class="">



  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href='/docs-uan/en-219'>
  User Access Nodes
</a>

    </div>

    
    <section>
      <ul>
      
        <li>
          <div class="select-style padding">
          v <select id="select-language" onchange="location = this.value;">
          
          
          
              
              
                  
              
                  
                    
                    
                      <option id="en-219" value="/docs-uan/en-219/operations/build_a_new_uan_image_using_the_default_recipe/" selected>2.1.9</option>
                    
                  
              
          
        </select>
        <svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
          width="255px" height="255px" viewBox="0 0 255 255" style="enable-background:new 0 0 255 255;" xml:space="preserve">
          <g>
            <g id="arrow-drop-down">
              <polygon points="0,63.75 127.5,191.25 255,63.75 		" />
            </g>
          </g>
        </svg>
        </div>
        </li>
      

      
      </ul>
    </section>
  

    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="/docs-uan/js/lunr.min.js?1644019530"></script>
<script type="text/javascript" src="/docs-uan/js/auto-complete.js?1644019530"></script>
<script type="text/javascript">
    
        var baseurl = "\/docs-uan\/\/en-219";
    
</script>
<script type="text/javascript" src="/docs-uan/js/search.js?1644019530"></script>

    
  </div>

  

    <div class="highlightable">
    <ul class="topics">
      
      




 
  
    
    <li data-nav-id="/docs-uan/en-219/advanced/" title="Advanced" class="dd-item
        
        
        
        ">
      <a href="/docs-uan/en-219/advanced/">
          Advanced
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/docs-uan/en-219/advanced/customizing_uan_images_manually/" title="Customizing UAN Images Manually" class="dd-item ">
        <a href="/docs-uan/en-219/advanced/customizing_uan_images_manually/">
        Customizing UAN Images Manually
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

      
      




 
  
    
    <li data-nav-id="/docs-uan/en-219/install/" title="Install" class="dd-item
        
        
        
        ">
      <a href="/docs-uan/en-219/install/">
          Install
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/docs-uan/en-219/install/install_the_uan_product_stream/" title="Install The UAN Product Stream" class="dd-item ">
        <a href="/docs-uan/en-219/install/install_the_uan_product_stream/">
        Install The UAN Product Stream
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

      
      




 
  
    
    <li data-nav-id="/docs-uan/en-219/installation_prereqs/" title="Installation Prereqs" class="dd-item
        
        
        
        ">
      <a href="/docs-uan/en-219/installation_prereqs/">
          Installation Prereqs
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/docs-uan/en-219/installation_prereqs/configure_the_bios_of_a_gigabyte_uan/" title="Configure The Bios Of A Gigabyte UAN" class="dd-item ">
        <a href="/docs-uan/en-219/installation_prereqs/configure_the_bios_of_a_gigabyte_uan/">
        Configure The Bios Of A Gigabyte UAN
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/docs-uan/en-219/installation_prereqs/configure_the_bios_of_an_hpe_uan/" title="Configure The Bios Of An HPE UAN" class="dd-item ">
        <a href="/docs-uan/en-219/installation_prereqs/configure_the_bios_of_an_hpe_uan/">
        Configure The Bios Of An HPE UAN
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/docs-uan/en-219/installation_prereqs/configure_the_bmc_for_uans_with_ilo/" title="Configure The BMC For UANs With Ilo" class="dd-item ">
        <a href="/docs-uan/en-219/installation_prereqs/configure_the_bmc_for_uans_with_ilo/">
        Configure The BMC For UANs With Ilo
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/docs-uan/en-219/installation_prereqs/prepare_for_uan_product_installation/" title="Prepare For UAN Product Installation" class="dd-item ">
        <a href="/docs-uan/en-219/installation_prereqs/prepare_for_uan_product_installation/">
        Prepare For UAN Product Installation
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

      
      




 
  
    
    <li data-nav-id="/docs-uan/en-219/operations/" title="Operations" class="dd-item
        parent
        
        
        ">
      <a href="/docs-uan/en-219/operations/">
          Operations
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/docs-uan/en-219/operations/build_a_new_uan_image_using_the_default_recipe/" title="Build A New UAN Image Using The Default Recipe" class="dd-item active">
        <a href="/docs-uan/en-219/operations/build_a_new_uan_image_using_the_default_recipe/">
        Build A New UAN Image Using The Default Recipe
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/docs-uan/en-219/operations/configure_interfaces_on_uans/" title="Configure Interfaces On UANs" class="dd-item ">
        <a href="/docs-uan/en-219/operations/configure_interfaces_on_uans/">
        Configure Interfaces On UANs
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/docs-uan/en-219/operations/configure_pluggable_authentication_modules_pam_on_uans/" title="Configure Pluggable Authentication Modules (pam) On UANs" class="dd-item ">
        <a href="/docs-uan/en-219/operations/configure_pluggable_authentication_modules_pam_on_uans/">
        Configure Pluggable Authentication Modules (pam) On UANs
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/docs-uan/en-219/operations/create_uan_boot_images/" title="Create UAN Boot Images" class="dd-item ">
        <a href="/docs-uan/en-219/operations/create_uan_boot_images/">
        Create UAN Boot Images
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/docs-uan/en-219/operations/mount_a_new_file_system_on_an_uan/" title="Mount A New File System On A UAN" class="dd-item ">
        <a href="/docs-uan/en-219/operations/mount_a_new_file_system_on_an_uan/">
        Mount A New File System On A UAN
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/docs-uan/en-219/operations/uan_ansible_roles/" title="UAN Ansible Roles" class="dd-item ">
        <a href="/docs-uan/en-219/operations/uan_ansible_roles/">
        UAN Ansible Roles
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/docs-uan/en-219/operations/about_uan_configuration/" title="About UAN Configuration" class="dd-item ">
        <a href="/docs-uan/en-219/operations/about_uan_configuration/">
        About UAN Configuration
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/docs-uan/en-219/operations/boot_uans/" title="Boot UANs" class="dd-item ">
        <a href="/docs-uan/en-219/operations/boot_uans/">
        Boot UANs
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

      
      




 
  
    
    <li data-nav-id="/docs-uan/en-219/troubleshooting/" title="Troubleshooting" class="dd-item
        
        
        
        ">
      <a href="/docs-uan/en-219/troubleshooting/">
          Troubleshooting
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/docs-uan/en-219/troubleshooting/troubleshoot_uan_boot_issues/" title="Troubleshoot UAN Boot Issues" class="dd-item ">
        <a href="/docs-uan/en-219/troubleshooting/troubleshoot_uan_boot_issues/">
        Troubleshoot UAN Boot Issues
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/docs-uan/en-219/troubleshooting/troubleshoot_uan_cfs_and_network_configuration_issues/" title="Troubleshoot UAN CFS And Network Configuration Issues" class="dd-item ">
        <a href="/docs-uan/en-219/troubleshooting/troubleshoot_uan_cfs_and_network_configuration_issues/">
        Troubleshoot UAN CFS And Network Configuration Issues
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/docs-uan/en-219/troubleshooting/troubleshoot_uan_disk_configuration_issues/" title="Troubleshoot UAN Disk Configuration Issues" class="dd-item ">
        <a href="/docs-uan/en-219/troubleshooting/troubleshoot_uan_disk_configuration_issues/">
        Troubleshoot UAN Disk Configuration Issues
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

      
      




 
  
    
    <li data-nav-id="/docs-uan/en-219/upgrade/" title="Upgrade" class="dd-item
        
        
        
        ">
      <a href="/docs-uan/en-219/upgrade/">
          Upgrade
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/docs-uan/en-219/upgrade/merge_uan_configuration_data/" title="Merge UAN Configuration Data" class="dd-item ">
        <a href="/docs-uan/en-219/upgrade/merge_uan_configuration_data/">
        Merge UAN Configuration Data
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

      
    </ul>

    
    

    
    <section id="footer">
      
    </section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            
            
          
          
            <a href='/docs-uan/en-219/'>Cray User Access Node Documentation</a> > <a href='/docs-uan/en-219/operations/'>Operations</a> > Build A New UAN Image Using The Default Recipe
          
        
          
        
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
  <ul>
    <li><a href="#build-a-new-uan-image-using-the-default-recipe">Build a New UAN Image Using the Default Recipe</a></li>
  </ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
            </h1>
          

        


<h2 id="build-a-new-uan-image-using-the-default-recipe">Build a New UAN Image Using the Default Recipe</h2>
<p>Perform this procedure to build or rebuild the UAN image using either the default UAN image or image recipe. Both of these are supplied by the UAN product stream installer.</p>
<p>Perform the following before starting this procedure:</p>
<ul>
<li>Install both the COS and UAN product streams.</li>
<li>Initialize the cray administrative CLI.</li>
</ul>
<p>The Cray EX User Access Node (UAN) recipe currently requires the Slingshot packages, which are not installed with the UAN product itself. Therefore, the UAN recipe can only be built after either the Slingshot product is installed, or after the Slingshot packages are removed from the recipe.</p>
<p>If Slingshot is installed, refer to the section &ldquo;Install Slingshot Network Drivers on HPE Cray EX&rdquo; in the Slingshot product documentation to specify the correct version of Slingshot in the UAN recipe.</p>
<p>UAN images built without the Slingshot packages are not able to mount Lustre filesystems. Therefore, the UANs that run those images are limited in usefulness.</p>
<ol>
<li>
<p>Determine if the Slingshot product stream is installed on the HPE Cray EX system.</p>
<p>The Slingshot Diagnostics RPM and the following packages must be removed from the default recipe if the Slingshot product is not installed:</p>
<ul>
<li>slingshot-firmware-management</li>
<li>slingshot-firmware-mellanox</li>
<li>slingshot-utils</li>
</ul>
</li>
<li>
<p>Modify the default UAN recipe to remove the Slingshot packages. Skip this step if the Slingshot packages are not installed.</p>
<p>a. Perform the procedure &ldquo;Upload and Register an Image Recipe&rdquo; in the CSM documentation to download and extract the UAN image recipe, <code>cray-sles15sp1-uan-cos</code>, but stop before the step that modifies the recipe.</p>
<p>b. Open the file <code>config-template.xml.j2</code> within the recipe for editing and remove these lines:</p>
<pre><code> ```xml
  &lt;!-- SECTION: Slingshot Diagnostic package --&gt;
      &lt;package name=&quot;cray-diags-fabric&quot;/&gt;
      &lt;package name=&quot;slingshot-firmware-management&quot;/&gt;
      &lt;package name=&quot;slingshot-firmware-mellanox&quot;/&gt;
      &lt;package name=&quot;slingshot-utils&quot;/&gt;
 ```
</code></pre>
<p>c. Resume the procedure &ldquo;Upload and Register an Image Recipe&rdquo;, starting with the step that locates the directory that contains the Kiwi-NG image description files.</p>
<pre><code> The next substep requires the id of the new image recipe record.
</code></pre>
<p>d. Perform the procedure &ldquo;Build an Image Using IMS REST Service&rdquo; in the CSM documentation to build the UAN image from the modified recipe. Use the id of the new image recipe.</p>
<pre><code> Skip the remaining steps of this current procedure.
</code></pre>
</li>
<li>
<p><strong>Optional:</strong> Build the UAN image using IMS. Skip this step to build the UAN image manually.</p>
<p>a. Identify the UAN image recipe.</p>
<pre><code> ```bash
 ncn-m001# cray ims recipes list --format json | jq '.[] | select(.name | contains(&quot;uan&quot;))'
 {
   &quot;created&quot;: &quot;2021-02-17T15:19:48.549383+00:00&quot;,
   &quot;id&quot;: &quot;4a5d1178-80ad-4151-af1b-bbe1480958d1&quot;,  &lt;&lt;-- Note this ID
   &quot;link&quot;: {
     &quot;etag&quot;: &quot;3c3b292364f7739da966c9cdae096964&quot;,
     &quot;path&quot;: &quot;s3://ims/recipes/4a5d1178-80ad-4151-af1b-bbe1480958d1/recipe.tar.gz&quot;,
     &quot;type&quot;: &quot;s3&quot;
   },
   &quot;linux_distribution&quot;: &quot;sles15&quot;,
   &quot;name&quot;: &quot;cray-shasta-uan-cos-sles15sp1.x86_64-@product_version@&quot;,
   &quot;recipe_type&quot;: &quot;kiwi-ng&quot;
 }
 ```
</code></pre>
<p>b. Save the id of the IMS recipe in an environment variable.</p>
<pre><code> ```bash
 ncn-m001# export IMS_RECIPE_ID=4a5d1178-80ad-4151-af1b-bbe1480958d1
 ```
</code></pre>
<p>c. Use the saved IMS recipe id in the procedure &ldquo;Build an Image Using IMS REST Service&rdquo; in the CSM documentation to build the UAN image.</p>
</li>
<li>
<p><strong>Optional:</strong> Build the UAN image by customizing it manually. Skip this step if the UAN image was built automatically in the previous step.</p>
<p>a. Identify the base UAN image to customize.</p>
<pre><code> ```bash
 ncn-m001# cray ims images list --format json | jq '.[] | select(.name | contains(&quot;uan&quot;))'
 {
   &quot;created&quot;: &quot;2021-02-18T17:17:44.168655+00:00&quot;,
   &quot;id&quot;: &quot;6d46d601-c41f-444d-8b49-c9a2a55d3c21&quot;,
   &quot;link&quot;: {
     &quot;etag&quot;: &quot;371b62c9f0263e4c8c70c8602ccd5158&quot;,
     &quot;path&quot;: &quot;s3://boot-images/6d46d601-c41f-444d-8b49-c9a2a55d3c21/manifest.json&quot;,
     &quot;type&quot;: &quot;s3&quot;
   },
   &quot;name&quot;: &quot;uan-PRODUCT_VERSION-image&quot;
 }
 ```
</code></pre>
<p>b. Save the id of the IMS image in an environment variable.</p>
<pre><code> ```bash
 ncn-m001# export IMS_IMAGE_ID=6d46d601-c41f-444d-8b49-c9a2a55d3c21
 ```
</code></pre>
<p>c. Use the saved IMS image id in the procedure &ldquo;Customize an Image Root Using IMS&rdquo; in the CSM documentation to build the UAN image.</p>
</li>
<li>
<p>Perform <a href="/docs-uan/en-219/operations/boot_uans/#boot-uans">Boot UANs</a> to boot the UANs with this new image.</p>
</li>
</ol>


<footer class="footline">
	
</footer>

        
        </div>
        

      </div>

    <div id="navigation">
        
        

        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        

        


	 
	 
    </div>

    </section>

    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/docs-uan/js/clipboard.min.js?1644019530"></script>
    <script src="/docs-uan/js/perfect-scrollbar.min.js?1644019530"></script>
    <script src="/docs-uan/js/perfect-scrollbar.jquery.min.js?1644019530"></script>
    <script src="/docs-uan/js/jquery.sticky.js?1644019530"></script>
    <script src="/docs-uan/js/featherlight.min.js?1644019530"></script>
    <script src="/docs-uan/js/highlight.pack.js?1644019530"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/docs-uan/js/modernizr.custom-3.6.0.js?1644019530"></script>
    <script src="/docs-uan/js/learn.js?1644019530"></script>
    <script src="/docs-uan/js/hugo-learn.js?1644019530"></script>
    
        
            <script src="/docs-uan/mermaid/mermaid.js?1644019530"></script>
        
        <script>
            mermaid.initialize({ startOnLoad: true });
        </script>
    
    

  </body>
</html>

