<!DOCTYPE html>
<html lang="en-255" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="generator" content="Hugo 0.101.0">
    <meta name="generator" content="Relearn 5.8.1+tip">
    <meta name="robots" content="noindex, nofollow, noarchive, noimageindex">
    <meta name="description" content="">
    <title>User Access Node (UAN)</title>
    <!-- https://github.com/filamentgroup/loadCSS/blob/master/README.md#how-to-use -->
    <link href="/docs-uan/css/fontawesome-all.min.css?1670951100" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/docs-uan/css/fontawesome-all.min.css?1670951100" rel="stylesheet"></noscript>
    <link href="/docs-uan/css/featherlight.min.css?1670951100" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/docs-uan/css/featherlight.min.css?1670951100" rel="stylesheet"></noscript>
    <link href="/docs-uan/css/auto-complete.css?1670951100" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/docs-uan/css/auto-complete.css?1670951100" rel="stylesheet"></noscript>
    <link href="/docs-uan/css/perfect-scrollbar.min.css?1670951100" rel="stylesheet">
    <link href="/docs-uan/css/nucleus.css?1670951100" rel="stylesheet">
    <link href="/docs-uan/css/fonts.css?1670951100" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/docs-uan/css/fonts.css?1670951100" rel="stylesheet"></noscript>
    <link href="/docs-uan/css/theme.css?1670951100" rel="stylesheet">
    <link href="/docs-uan/css/theme-green.css?1670951100" rel="stylesheet" id="variant-style">
    <link href="/docs-uan/css/ie.css?1670951100" rel="stylesheet">
    <link href="/docs-uan/css/variant.css?1670951100" rel="stylesheet">
    <link href="/docs-uan/css/print.css?1670951100" rel="stylesheet" media="print">
    <script src="/docs-uan/js/url.js?1670951100"></script>
    <script src="/docs-uan/js/variant.js?1670951100"></script>
    <script>
      // hack to let hugo tell us how to get to the root when using relativeURLs, it needs to be called *url= for it to do its magic:
      // https://github.com/gohugoio/hugo/blob/145b3fcce35fbac25c7033c91c1b7ae6d1179da8/transform/urlreplacers/absurlreplacer.go#L72
      window.index_js_url="/docs-uan/index.search.js";
      var root_url="/";
      var baseUri=root_url.replace(/\/$/, '');
      // translations
      window.T_Copy_to_clipboard = '';
      window.T_Copied_to_clipboard = '';
      window.T_Copy_link_to_clipboard = '';
      window.T_Link_copied_to_clipboard = '';
      window.T_No_results_found = '';
      window.T_N_results_found = '';
      // some further base stuff
      var baseUriFull='docs-uan/';
      window.variants && variants.init( [ 'green' ] );
    </script>
    <script src="/docs-uan/js/jquery.min.js?1670951100" defer></script>
  </head>
  <body class="mobile-support html" data-url="/docs-uan/upgrade/merge_uan_configuration_data/index.html">
    <div id="body" class="default-animation">
      <div id="sidebar-overlay"></div>
      <div id="toc-overlay"></div>
      <nav id="topbar" class="highlightable" dir="ltr">
        <div>
          <div id="breadcrumbs">
            <span id="sidebar-toggle-span">
              <a href="#" id="sidebar-toggle" title=' (CTRL+ALT+n)'><i class="fas fa-bars fa-fw"></i></a>
            </span>
            <ol class="links" itemscope itemtype="http://schema.org/BreadcrumbList">
              <li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><a itemprop="item" href="/docs-uan/index.html"><span itemprop="name">User Access Node (UAN)</span></a><meta itemprop="position" content="1"> > </li>
              <li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><a itemprop="item" href="/docs-uan/upgrade/index.html"><span itemprop="name">User Access Node (UAN)</span></a><meta itemprop="position" content="2"> > </li>
              <li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><span itemprop="name">User Access Node (UAN)</span><meta itemprop="position" content="3"></li>
            </ol>
          </div>
        </div>
      </nav>
      <main id="body-inner" class="highlightable default" tabindex="-1">
        <div class="flex-block-wrapper">
          <div id="head-tags">
          </div>
          <article class="default">
<h1 id=""></h1>

<h1 id="merge-uan-configuration-data">Merge UAN Configuration Data</h1>
<p>Perform this procedure to update the UAN product configuration.</p>
<p>Before performing this procedure, perform <a href="/docs-uan/install/install_the_uan_product_stream/#install-the-uan-product-stream">Install the UAN Product Stream</a></p>
<p>In this procedure, an upgrade from UAN 2.0.0 to UAN 2.3.1 is being performed. Administrators should replace the versions seen in this procedure with the versions being upgraded on the system. Additionally, this guide describes upgrading an <code>integration</code> branch. Each CFS branch responsible for configuring the various types of Application and UANs should be upgraded.</p>
<ol>
<li>
<p>Start a typescript to capture the commands and output from the procedure.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ncn-m001# script -af product-uan.$<span style="color:#ae81ff">\(</span>date +%Y-%m-%d<span style="color:#ae81ff">\)</span>.txt
</span></span><span style="display:flex;"><span>ncn-m001# export PS1<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;\u@\H \D{%Y-%m-%d} \t \w # &#39;</span>
</span></span></code></pre></div></li>
<li>
<p>Obtain the URL of the UAN configuration management repository in VCS (the Gitea service).</p>
<p>This URL is reported as the value of the <code>configuration.clone_url</code> key in the <code>cray-product-catalog</code> Kubernetes ConfigMap.</p>
</li>
<li>
<p>Obtain the <code>crayvcs</code> password.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ncn-m001# kubectl get secret -n services vcs-user-credentials <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span> --template<span style="color:#f92672">={{</span>.data.vcs_password<span style="color:#f92672">}}</span> | base64 --decode
</span></span></code></pre></div></li>
<li>
<p>Clone the UAN configuration management repository. Replace the hostname reported in the URL obtained in the previous step with <code>api-gw-service-nmm.local</code> when cloning the repository.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ncn-m001# git clone https://api-gw-service-nmn.local/vcs/cray/uan-config-management.git
</span></span><span style="display:flex;"><span>. . .
</span></span><span style="display:flex;"><span>ncn-m001# cd uan-config-management <span style="color:#f92672">&amp;&amp;</span> git checkout cray/uan/PRODUCT_VERSION <span style="color:#f92672">&amp;&amp;</span> git pull
</span></span><span style="display:flex;"><span>Branch <span style="color:#e6db74">&#39;cray/uan/PRODUCT_VERSION&#39;</span> set up to track remote branch <span style="color:#e6db74">&#39;cray/uan/PRODUCT_VERSION&#39;</span> 
</span></span><span style="display:flex;"><span>from <span style="color:#e6db74">&#39;origin&#39;</span>.
</span></span><span style="display:flex;"><span>Already up to date.
</span></span></code></pre></div></li>
<li>
<p>Checkout the branch currently used to hold UAN configuration.</p>
<p>The following example assumes that branch is <code>integration</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ncn-m001# git checkout integration
</span></span><span style="display:flex;"><span>Switched to branch <span style="color:#e6db74">&#39;integration&#39;</span>
</span></span><span style="display:flex;"><span>Your branch is up to date with <span style="color:#e6db74">&#39;origin/integration&#39;</span>.
</span></span></code></pre></div></li>
<li>
<p>Merge the new install branch to the current branch. Write a commit message when prompted.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ncn-m001# git merge cray/uan/PRODUCT_VERSION
</span></span></code></pre></div></li>
<li>
<p>Push the changes to VCS. Enter the <code>crayvcs</code> password when prompted.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ncn-m001# git push
</span></span></code></pre></div></li>
<li>
<p>Retrieve the commit ID from the merge and store it for later use.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ncn-m001# git rev-parse --verify HEAD
</span></span></code></pre></div></li>
<li>
<p>Update any CFS configurations used by the UANs with the commit ID from the previous step.</p>
<ol>
<li>
<p>Download the JSON of the current UAN CFS configuration to a file.</p>
<p>The CFS configuration <code>uan-config-2.0.0</code> is an example, the site should use the CFS configuration used for the UANs being upgraded.</p>
<p>This file will be named <code>uan-config-2.3.1.json</code> since it will be modified and then used for the updated UAN version.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ncn-m001# cray cfs configurations describe uan-config-2.0.0 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--format<span style="color:#f92672">=</span>json &amp;&gt;uan-config-2.3.1.json
</span></span></code></pre></div></li>
<li>
<p>Remove the unneeded lines from the JSON file.</p>
<p>The lines to remove are:</p>
<ul>
<li>the <code>lastUpdated</code> line</li>
<li>the last <code>name</code> line</li>
</ul>
<p>These must be removed before uploading the modified JSON file back into CFS to update the UAN configuration.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ncn-m001# cat uan-config-2.3.1.json
</span></span><span style="display:flex;"><span><span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;lastUpdated&#34;</span>: <span style="color:#e6db74">&#34;2021-03-27T02:32:10Z&#34;</span>,      
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;layers&#34;</span>: <span style="color:#f92672">[</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;cloneUrl&#34;</span>: <span style="color:#e6db74">&#34;https://api-gw-service-nmn.local/vcs/cray/uan-config-management.git&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;commit&#34;</span>: <span style="color:#e6db74">&#34;aa5ce7d5975950ec02493d59efb89f6fc69d67f1&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;uan-integration-2.0.0&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;playbook&#34;</span>: <span style="color:#e6db74">&#34;site.yml&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;uan-config-2.0.0&#34;</span>            
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div></li>
<li>
<p>Replace the <code>commit</code> value in the JSON file with the commit ID obtained with <code>git rev-parse --verify HEAD</code>.</p>
<p>The <code>name</code> value after the <code>commit</code> line may also be updated to match the new UAN product version, if desired. This is not necessary as CFS does not use this value for the configuration name.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span> <span style="color:#e6db74">&#34;layers&#34;</span>: <span style="color:#f92672">[</span>
</span></span><span style="display:flex;"><span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span> <span style="color:#e6db74">&#34;cloneUrl&#34;</span>: <span style="color:#e6db74">&#34;https://api-gw-service-nmn.local/vcs/cray/uan-configmanagement.git&#34;</span>,
</span></span><span style="display:flex;"><span> <span style="color:#e6db74">&#34;commit&#34;</span>: <span style="color:#e6db74">&#34;aa5ce7d5975950ec02493d59efb89f6fc69d67f1&#34;</span>,
</span></span><span style="display:flex;"><span> <span style="color:#e6db74">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;uan-integration-2.0.0&#34;</span>,
</span></span><span style="display:flex;"><span> <span style="color:#e6db74">&#34;playbook&#34;</span>: <span style="color:#e6db74">&#34;site.yml&#34;</span>
</span></span><span style="display:flex;"><span> <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span> <span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div></li>
<li>
<p>Create a new UAN CFS configuration with the updated JSON file.</p>
<p>The following example uses <code>uan-config-2.3.1</code> for the name of the new CFS configuration, to match the JSON file name.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ncn-m001# cray cfs configurations update uan-config-2.3.1 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--file uan-config-2.3.1.json
</span></span></code></pre></div></li>
</ol>
</li>
<li>
<p>Finish the typescript file started at the beginning of this procedure.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ncn-m001# exit
</span></span></code></pre></div></li>
<li>
<p>Deploy the updated UAN product software to the User Access Nodes.</p>
<p>Continue with &ldquo;Build a New UAN Image Using the COS Recipe&rdquo; and &ldquo;Create UAN Boot Images&rdquo; in the publication <em>HPE Cray User Access Node (UAN) Software Administration Guide</em> to upgrade the boot images and perform CFS image customization for the UAN images.</p>
</li>
</ol>

            <footer class="footline">
            </footer>
          </article>
        </div>
      </main>
    </div>
    <aside id="sidebar" class="default-animation" dir="ltr">
      <div id="header-wrapper" class="default-animation">
        <div id="header" class="default-animation">
<a id="logo" href='/docs-uan/'>
  <img src="/docs-uan/images/hpe.png" alt="HPE" />
</a>
        </div>
        <div class="searchbox default-animation">
          <i class="fas fa-search" title=" (CTRL+ALT+f)"></i>
          <label class="a11y-only" for="search-by"></label>
          <input data-search-input id="search-by" name="search-by" class="search-by" type="search" placeholder="">
          <span data-search-clear=""><i class="fas fa-times"></i></span>
        </div>
        <script>
          var contentLangs=['en'];
        </script>
        <script src="/docs-uan/js/auto-complete.js?1670951100" defer></script>
        <script src="/docs-uan/js/lunr.min.js?1670951100" defer></script>
        <script src="/docs-uan/js/lunr.stemmer.support.min.js?1670951100" defer></script>
        <script src="/docs-uan/js/lunr.multi.min.js?1670951100" defer></script>
        <script src="/docs-uan/js/lunr.en.min.js?1670951100" defer></script>
        <script src="/docs-uan/js/search.js?1670951100" defer></script>
      </div>
      <div id="content-wrapper" class="highlightable">
        <ul class="topics">
          <li data-nav-id="/docs-uan/upgrade/index.html" class="dd-item parent"><a href="/docs-uan/upgrade/index.html">Upgrade</a><ul id="subsections-666a3194818cce52ab05338c76c67e5c">
          <li data-nav-id="/docs-uan/upgrade/merge_uan_configuration_data/index.html" class="dd-item active"><a href="/docs-uan/upgrade/merge_uan_configuration_data/index.html">Merge UAN Configuration Data</a></li></ul></li>
        </ul>
        <div class="footermargin footerLangSwitch footerVariantSwitch footerVisitedLinks footerFooter showFooter"></div>
        <hr class="default-animation footerLangSwitch footerVariantSwitch footerVisitedLinks footerFooter showFooter">
        <div id="prefooter" class="footerLangSwitch footerVariantSwitch footerVisitedLinks">
          <ul>
            <li id="select-language-container" class="footerLangSwitch">
              <div class="padding select-container">
                <i class="fas fa-language fa-fw"></i>
                <span>&nbsp;</span>
                <div class="select-style">
                  <label class="a11y-only" for="select-language"></label>
                  <select id="select-language" onchange="location = baseUri + this.value;">
                  </select>
                </div>
                <div class="select-clear"></div>
              </div>
            </li>
            <li id="select-variant-container" class="footerVariantSwitch">
              <div class="padding select-container">
                <i class="fas fa-paint-brush fa-fw"></i>
                <span>&nbsp;</span>
                <div class="select-style">
                  <label class="a11y-only" for="select-variant"></label>
                  <select id="select-variant" onchange="window.variants && variants.changeVariant( this.value );">
                    <option id="green" value="green" selected>Green</option>
                  </select>
                </div>
                <div class="select-clear"></div>
              </div>
              <script>window.variants && variants.markSelectedVariant();</script>
            </li>
            <li class="footerVisitedLinks"><button class="padding" onclick="clearHistory();"><i class="fas fa-history fa-fw"></i> </button></li>
          </ul>
        </div>
        <div id="footer" class="footerFooter showFooter">
	    <p>Built with <a href="https://github.com/McShelby/hugo-theme-relearn" title="love"><i class="fas fa-heart"></i></a> by <a href="https://gohugo.io/">Hugo</a></p>
        </div>
      </div>
    </aside>
    <script src="/docs-uan/js/clipboard.min.js?1670951100" defer></script>
    <script src="/docs-uan/js/perfect-scrollbar.min.js?1670951100" defer></script>
    <script src="/docs-uan/js/featherlight.min.js?1670951100" defer></script>
    <script src="/docs-uan/js/theme.js?1670951100" defer></script>
  </body>
</html>
