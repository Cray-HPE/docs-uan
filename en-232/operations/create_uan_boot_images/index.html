<!DOCTYPE html>
<html lang="en-232" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.87.0" />
    <meta name="description" content="">


    <link rel="icon" href="/docs-uan/images/favicon.png" type="image/png">

    <title>Create UAN Boot Images :: User Access Node (UAN)</title>

    
    <link href="/docs-uan/css/nucleus.css?1649114394" rel="stylesheet">
    <link href="/docs-uan/css/fontawesome-all.min.css?1649114394" rel="stylesheet">
    <link href="/docs-uan/css/hybrid.css?1649114394" rel="stylesheet">
    <link href="/docs-uan/css/featherlight.min.css?1649114394" rel="stylesheet">
    <link href="/docs-uan/css/perfect-scrollbar.min.css?1649114394" rel="stylesheet">
    <link href="/docs-uan/css/auto-complete.css?1649114394" rel="stylesheet">
    <link href="/docs-uan/css/atom-one-dark-reasonable.css?1649114394" rel="stylesheet">
    <link href="/docs-uan/css/theme.css?1649114394" rel="stylesheet">
    <link href="/docs-uan/css/tabs.css?1649114394" rel="stylesheet">
    <link href="/docs-uan/css/hugo-theme.css?1649114394" rel="stylesheet">
    
    <link href="/docs-uan/css/theme-blue.css?1649114394" rel="stylesheet">
    
    

    <script src="/docs-uan/js/jquery-3.3.1.min.js?1649114394"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
    </style>
    
  </head>
  <body class="" data-url="/docs-uan/en-232/operations/create_uan_boot_images/">
    <nav id="sidebar" class="">



  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href='/docs-uan/en-232'>
  User Access Nodes
</a>

    </div>

    
    <section>
      <ul>
      
        <li>
          <div class="select-style padding">
          v <select id="select-language" onchange="location = this.value;">
          
          
          
              
              
                  
                    
                    
                      <option id="en-232" value="/docs-uan/en-232/operations/create_uan_boot_images/" selected>v2.3.2</option>
                    
                  
              
                  
              
          
              
              
                  
              
                  
                    
                    
                      <option id="en-231" value="/docs-uan/en-231/operations/create_uan_boot_images/">v2.3.1</option>
                    
                  
              
          
        </select>
        <svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
          width="255px" height="255px" viewBox="0 0 255 255" style="enable-background:new 0 0 255 255;" xml:space="preserve">
          <g>
            <g id="arrow-drop-down">
              <polygon points="0,63.75 127.5,191.25 255,63.75 		" />
            </g>
          </g>
        </svg>
        </div>
        </li>
      

      
      </ul>
    </section>
  

    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="/docs-uan/js/lunr.min.js?1649114394"></script>
<script type="text/javascript" src="/docs-uan/js/auto-complete.js?1649114394"></script>
<script type="text/javascript">
    
        var baseurl = "\/docs-uan\/\/en-232";
    
</script>
<script type="text/javascript" src="/docs-uan/js/search.js?1649114394"></script>

    
  </div>

  

    <div class="highlightable">
    <ul class="topics">
      
      




 
  
    
    <li data-nav-id="/docs-uan/en-232/advanced/" title="Advanced" class="dd-item
        
        
        
        ">
      <a href="/docs-uan/en-232/advanced/">
          Advanced
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/docs-uan/en-232/advanced/customizing_uan_images_manually/" title="Customizing UAN Images Manually" class="dd-item ">
        <a href="/docs-uan/en-232/advanced/customizing_uan_images_manually/">
        Customizing UAN Images Manually
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

      
      




 
  
    
      <li data-nav-id="/docs-uan/en-232/changelog/" title="Changelog" class="dd-item ">
        <a href="/docs-uan/en-232/changelog/">
        Changelog
        
        </a>
    </li>
     
  
 

      
      




 
  
    
    <li data-nav-id="/docs-uan/en-232/install/" title="Install" class="dd-item
        
        
        
        ">
      <a href="/docs-uan/en-232/install/">
          Install
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/docs-uan/en-232/install/install_the_uan_product_stream/" title="Install The UAN Product Stream" class="dd-item ">
        <a href="/docs-uan/en-232/install/install_the_uan_product_stream/">
        Install The UAN Product Stream
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

      
      




 
  
    
    <li data-nav-id="/docs-uan/en-232/installation_prereqs/" title="Installation Prereqs" class="dd-item
        
        
        
        ">
      <a href="/docs-uan/en-232/installation_prereqs/">
          Installation Prereqs
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/docs-uan/en-232/installation_prereqs/configure_the_bios_of_a_gigabyte_uan/" title="Configure The Bios Of A Gigabyte UAN" class="dd-item ">
        <a href="/docs-uan/en-232/installation_prereqs/configure_the_bios_of_a_gigabyte_uan/">
        Configure The Bios Of A Gigabyte UAN
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/docs-uan/en-232/installation_prereqs/configure_the_bios_of_an_hpe_uan/" title="Configure The Bios Of An HPE UAN" class="dd-item ">
        <a href="/docs-uan/en-232/installation_prereqs/configure_the_bios_of_an_hpe_uan/">
        Configure The Bios Of An HPE UAN
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/docs-uan/en-232/installation_prereqs/configure_the_bmc_for_uans_with_ilo/" title="Configure The BMC For UANs With Ilo" class="dd-item ">
        <a href="/docs-uan/en-232/installation_prereqs/configure_the_bmc_for_uans_with_ilo/">
        Configure The BMC For UANs With Ilo
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/docs-uan/en-232/installation_prereqs/prepare_for_uan_product_installation/" title="Prepare For UAN Product Installation" class="dd-item ">
        <a href="/docs-uan/en-232/installation_prereqs/prepare_for_uan_product_installation/">
        Prepare For UAN Product Installation
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

      
      




 
  
    
    <li data-nav-id="/docs-uan/en-232/operations/" title="Operations" class="dd-item
        parent
        
        
        ">
      <a href="/docs-uan/en-232/operations/">
          Operations
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/docs-uan/en-232/operations/uan_ansible_roles/" title="UAN Ansible Roles" class="dd-item ">
        <a href="/docs-uan/en-232/operations/uan_ansible_roles/">
        UAN Ansible Roles
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/docs-uan/en-232/operations/about_uan_configuration/" title="About UAN Configuration" class="dd-item ">
        <a href="/docs-uan/en-232/operations/about_uan_configuration/">
        About UAN Configuration
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/docs-uan/en-232/operations/boot_uans/" title="Boot UANs" class="dd-item ">
        <a href="/docs-uan/en-232/operations/boot_uans/">
        Boot UANs
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/docs-uan/en-232/operations/build_a_new_uan_image_using_the_cos_recipe/" title="Build A New UAN Image Using A Cos Recipe" class="dd-item ">
        <a href="/docs-uan/en-232/operations/build_a_new_uan_image_using_the_cos_recipe/">
        Build A New UAN Image Using A Cos Recipe
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/docs-uan/en-232/operations/configure_interfaces_on_uans/" title="Configure Interfaces On UANs" class="dd-item ">
        <a href="/docs-uan/en-232/operations/configure_interfaces_on_uans/">
        Configure Interfaces On UANs
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/docs-uan/en-232/operations/configure_pluggable_authentication_modules_pam_on_uans/" title="Configure Pluggable Authentication Modules (pam) On UANs" class="dd-item ">
        <a href="/docs-uan/en-232/operations/configure_pluggable_authentication_modules_pam_on_uans/">
        Configure Pluggable Authentication Modules (pam) On UANs
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/docs-uan/en-232/operations/create_uan_boot_images/" title="Create UAN Boot Images" class="dd-item active">
        <a href="/docs-uan/en-232/operations/create_uan_boot_images/">
        Create UAN Boot Images
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/docs-uan/en-232/operations/mount_a_new_file_system_on_an_uan/" title="Mount A New File System On A UAN" class="dd-item ">
        <a href="/docs-uan/en-232/operations/mount_a_new_file_system_on_an_uan/">
        Mount A New File System On A UAN
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

      
      




 
  
    
    <li data-nav-id="/docs-uan/en-232/test-plan/" title="Test-plan" class="dd-item
        
        
        
        ">
      <a href="/docs-uan/en-232/test-plan/">
          Test-plan
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/docs-uan/en-232/test-plan/test-plan/" title="Test Plan For User Access Node (UAN)" class="dd-item ">
        <a href="/docs-uan/en-232/test-plan/test-plan/">
        Test Plan For User Access Node (UAN)
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

      
      




 
  
    
    <li data-nav-id="/docs-uan/en-232/troubleshooting/" title="Troubleshooting" class="dd-item
        
        
        
        ">
      <a href="/docs-uan/en-232/troubleshooting/">
          Troubleshooting
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/docs-uan/en-232/troubleshooting/troubleshoot_uan_boot_issues/" title="Troubleshoot UAN Boot Issues" class="dd-item ">
        <a href="/docs-uan/en-232/troubleshooting/troubleshoot_uan_boot_issues/">
        Troubleshoot UAN Boot Issues
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/docs-uan/en-232/troubleshooting/troubleshoot_uan_cfs_and_network_configuration_issues/" title="Troubleshoot UAN CFS And Network Configuration Issues" class="dd-item ">
        <a href="/docs-uan/en-232/troubleshooting/troubleshoot_uan_cfs_and_network_configuration_issues/">
        Troubleshoot UAN CFS And Network Configuration Issues
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/docs-uan/en-232/troubleshooting/troubleshoot_uan_disk_configuration_issues/" title="Troubleshoot UAN Disk Configuration Issues" class="dd-item ">
        <a href="/docs-uan/en-232/troubleshooting/troubleshoot_uan_disk_configuration_issues/">
        Troubleshoot UAN Disk Configuration Issues
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

      
      




 
  
    
    <li data-nav-id="/docs-uan/en-232/upgrade/" title="Upgrade" class="dd-item
        
        
        
        ">
      <a href="/docs-uan/en-232/upgrade/">
          Upgrade
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/docs-uan/en-232/upgrade/merge_uan_configuration_data/" title="Merge UAN Configuration Data" class="dd-item ">
        <a href="/docs-uan/en-232/upgrade/merge_uan_configuration_data/">
        Merge UAN Configuration Data
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/docs-uan/en-232/upgrade/notable_changes/" title="Notable Changes" class="dd-item ">
        <a href="/docs-uan/en-232/upgrade/notable_changes/">
        Notable Changes
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/docs-uan/en-232/upgrade/upgrades/" title="Upgrades" class="dd-item ">
        <a href="/docs-uan/en-232/upgrade/upgrades/">
        Upgrades
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

      
    </ul>

    
    

    
    <section id="footer">
      
    </section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            
            
          
          
            <a href='/docs-uan/en-232/'>Cray Ex User Access Nodes Installation Guide</a> > <a href='/docs-uan/en-232/operations/'>Operations</a> > Create UAN Boot Images
          
        
          
        
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
  <ul>
    <li><a href="#create-uan-boot-images">Create UAN Boot Images</a></li>
  </ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
            </h1>
          

        


<h2 id="create-uan-boot-images">Create UAN Boot Images</h2>
<p>This procedure updates the configuration management git repository to match the installed version of the UAN product. That updated configuration is then used to create UAN boot images and a BOS session template.</p>
<p>UAN specific configuration, and other required configurations related to UANs are covered in this topic. Consult the documentation for the individual HPE products (for example, workload managers and the HPE Cray Programming Environment) that must be configured on the UANs.</p>
<p>This is the overall workflow for preparing UAN images for booting UANs:</p>
<ol>
<li>Clone the UAN configuration git repository and create a branch based on the branch imported by the UAN installation.</li>
<li>Update the configuration content and push the changes to the newly created branch.</li>
<li>Create a Configuration Framework Service (CFS) configuration for the UANs, specifying the git configuration and the UAN image to apply the configuration to. More HPE products can also be added to the CFS configuration so that the UANs can install multiple HPE products into the UAN image at the same time.</li>
<li>Add the Slingshot Host Software (SHS) CFS layer. SHS is a required layer in the CFS config for COS and UAN images.</li>
<li>Configure the UAN image using CFS and generate a newly configured version of the UAN image.</li>
<li>Create a Boot Orchestration Service (BOS) boot session template for the UANs. This template maps the configured image, the CFS configuration to be applied post-boot, and the nodes which will receive the image and configuration.</li>
</ol>
<p>Once the UAN BOS session template is created, the UANs will be ready to be booted by a BOS session.</p>
<p>Replace <code>PRODUCT_VERSION</code> and <code>CRAY_EX_HOSTNAME</code> in the example commands in this procedure with the current UAN product version installed (See Step 1) and the hostname of the HPE Cray EX system, respectively.</p>
<p><strong>UAN IMAGE PRE-BOOT CONFIGURATION</strong></p>
<ol>
<li>
<p>Obtain the artifact IDs and other information from the <code>cray-product-catalog</code> Kubernetes ConfigMap. Record the following information:</p>
<ul>
<li>the <code>clone_url</code></li>
<li>the <code>commit</code></li>
<li>the <code>import_branch</code> value</li>
</ul>
<p>Upon successful installation of the UAN product, the UAN configuration is cataloged in this ConfigMap. This information is required for this procedure.</p>
<p><code>PRODUCT_VERSION</code> will be replaced by a numbered version string, such as <code>2.1.7</code> or <code>2.3.0</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ncn-m001# kubectl get cm -n services cray-product-catalog -o json | jq -r .data.uan
PRODUCT_VERSION:
  configuration:
    clone_url: https://vcs.CRAY_EX_HOSTNAME/vcs/cray/uan-config-management.git 
    commit: 6658ea9e75f5f0f73f78941202664e9631a63726                   
    import_branch: cray/uan/PRODUCT_VERSION                           
    import_date: 2021-02-02 19:14:18.399670
    ssh_url: git@vcs.CRAY_EX_HOSTNAME:cray/uan-config-management.git                      
</code></pre></div></li>
<li>
<p><strong>Optional</strong> Generate the password hash for the <code>root</code> user. Replace PASSWORD with the <code>root</code> password you wish to use.  If an upgrade or image rebuild is being performed, the root password may have already been added to vault.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ncn-m001# openssl passwd -6 -salt <span style="color:#66d9ef">$(</span>&lt; /dev/urandom tr -dc _A-Z-a-z-0-9 | head -c4<span style="color:#66d9ef">)</span> PASSWORD
</code></pre></div></li>
<li>
<p><strong>Optional</strong> Obtain the HashiCorp Vault <code>root</code> token.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ncn-m001# kubectl get secrets -n vault cray-vault-unseal-keys -o jsonpath<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;{.data.vault-root}&#39;</span> | base64 -d; echo
</code></pre></div></li>
<li>
<p><strong>Optional</strong> Write the password hash obtained in Step 2 to the HashiCorp Vault.</p>
<p>The vault login command will request a token. That token value is the output of the previous step. The vault <code>read secret/uan</code> command verifies that the hash was stored correctly. This password hash will be written to the UAN for the <code>root</code> user by CFS.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ncn-m001# kubectl exec -it -n vault cray-vault-0 -- sh
export VAULT_ADDR<span style="color:#f92672">=</span>http://cray-vault:8200
vault login
vault write secret/uan root_password<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;HASH&#39;</span>
vault read secret/uan
</code></pre></div></li>
<li>
<p><strong>Optional</strong> Write any uan_ldap sensitive data, such as the <code>ldap_default_authtok</code> value, to the HashiCorp Vault.</p>
<p>The vault login command will request a token. That token value is the output of the Step 3. The vault <code>read secret/uan_ldap</code> command verifies that the <code>uan_ldap</code> data was stored correctly. Any values stored here will be written to the UAN <code>/etc/sssd/sssd.conf</code> file in the <code>[domain]</code> section by CFS.</p>
<p>This example shows storing a value for <code>ldap_default_authtok</code>.  If more than one variable needs to be stored, they must be written in space separated <code>key=value</code> pairs on the same <code>vault write secret/uan_ldap</code> command line.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ncn-m001# kubectl exec -it -n vault cray-vault-0 -- sh
export VAULT_ADDR<span style="color:#f92672">=</span>http://cray-vault:8200
vault login
vault write secret/uan_ldap ldap_default_authtok<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;TOKEN&#39;</span>
vault read secret/uan_ldap
</code></pre></div></li>
<li>
<p>Obtain the password for the <code>crayvcs</code> user from the Kubernetes secret for use in the next command.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ncn-m001# kubectl get secret -n services vcs-user-credentials --template<span style="color:#f92672">={{</span>.data.vcs_password<span style="color:#f92672">}}</span> | base64 --decode
</code></pre></div></li>
<li>
<p>Clone the UAN configuration management repository. Replace CRAY_EX_HOSTNAME in the clone url with <strong>api-gw-service-nmn.local</strong> when cloning the repository.</p>
<p>The repository is in the VCS/Gitea service and the location is reported in the cray-product-catalog Kubernetes ConfigMap in the <code>configuration.clone_url</code> key. The CRAY_EX_HOSTNAME from the <code>clone_url</code> is replaced with <code>api-gw-service-nmn.local</code> in the command that clones the repository.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ncn-m001# git clone https://api-gw-service-nmn.local/vcs/cray/uan-config-management.git
. . .
ncn-m001# cd uan-config-management <span style="color:#f92672">&amp;&amp;</span> git checkout cray/uan/PRODUCT_VERSION <span style="color:#f92672">&amp;&amp;</span> git pull
Branch <span style="color:#e6db74">&#39;cray/uan/PRODUCT_VERSION&#39;</span> set up to track remote branch <span style="color:#e6db74">&#39;cray/uan/PRODUCT_VERSION&#39;</span> from <span style="color:#e6db74">&#39;origin&#39;</span>.
Already up to date.
</code></pre></div></li>
<li>
<p>Create a branch using the imported branch from the installation to customize the UAN image.</p>
<p>This will be reported in the <code>cray-product-catalog</code> Kubernetes ConfigMap in the <code>configuration.import_branch</code> key under the UAN section. The format is cray/uan/PRODUCT_VERSION. In this guide, an <code>integration</code> branch is used for examples, but the name can be any valid git branch name.</p>
<p>Modifying the cray/uan/PRODUCT_VERSION branch that was created by the UAN product installation is not allowed by default.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ncn-m001# git checkout -b integration <span style="color:#f92672">&amp;&amp;</span> git merge cray/uan/PRODUCT_VERSION
Switched to a new branch <span style="color:#e6db74">&#39;integration&#39;</span>
Already up to date.
</code></pre></div></li>
<li>
<p>Apply any site-specific customizations and modifications to the Ansible configuration for the UAN nodes and commit the changes.</p>
<p>The default Ansible play to configure UAN nodes is <code>site.yml</code> in the base of the <code>uan-config-management</code> repository. The roles that are executed in this play allow for custom  configuration as required for the system.</p>
<p>Consult the individual Ansible role <code>README.md</code> files in the uan-config-management repository roles directory to configure individual role variables. Roles prefixed with <code>uan_</code> are specific to UAN configuration and include network interfaces, disk, LDAP, software packages, and message of the day roles.</p>
<p>Variables should be defined and overridden in the Ansible inventory locations of the repository as shown in the following example and <strong>not</strong> in the Ansible plays and roles defaults. See <a href="https://docs.ansible.com/ansible/2.9/user_guide/playbooks_best_practices.html#content-organization">this page from the Ansible documentation</a> for directory layouts for inventory.</p>
<p><strong>Warning:</strong> Never place sensitive information such as passwords in the git repository.</p>
<p>The following example shows how to add a <code>vars.yml</code> file containing site-specific configuration values to the <code>Application_UAN</code> group variable location.</p>
<p>These and other Ansible files do not necessarily need to be modified for UAN image creation. See <a href="/docs-uan/en-232/operations/about_uan_configuration/#about-uan-configuration">About UAN Configuration</a> for instructions for site-specific UAN configuration, including CAN configuration.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ncn-m001# vim group_vars/Application_UAN/vars.yml
ncn-m001# git add group_vars/Application_UAN/vars.yml
ncn-m001# git commit -m <span style="color:#e6db74">&#34;Add vars.yml customizations&#34;</span>
<span style="color:#f92672">[</span>integration ecece54<span style="color:#f92672">]</span> Add vars.yml customizations
 <span style="color:#ae81ff">1</span> file changed, <span style="color:#ae81ff">1</span> insertion<span style="color:#f92672">(</span>+<span style="color:#f92672">)</span>
 create mode <span style="color:#ae81ff">100644</span> group_vars/Application_UAN/vars.yml
</code></pre></div></li>
<li>
<p>Push the changes to the repository using the proper credentials, including the password obtained previously.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ncn-m001# git push --set-upstream origin integration
Username <span style="color:#66d9ef">for</span> <span style="color:#e6db74">&#39;https://api-gw-service-nmn.local&#39;</span>: crayvcs
Password <span style="color:#66d9ef">for</span> <span style="color:#e6db74">&#39;https://crayvcs@api-gw-service-nmn.local&#39;</span>:
. . .
remote: Processed <span style="color:#ae81ff">1</span> references in total
To https://api-gw-service-nmn.local/vcs/cray/uan-config-management.git
 * <span style="color:#f92672">[</span>new branch<span style="color:#f92672">]</span>      integration -&gt; integration
 Branch <span style="color:#e6db74">&#39;integration&#39;</span> set up to track remote branch <span style="color:#e6db74">&#39;integration&#39;</span> from <span style="color:#e6db74">&#39;origin&#39;</span>.
</code></pre></div></li>
<li>
<p>Capture the most recent commit for reference in setting up a CFS configuration and navigate to the parent directory.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ncn-m001# git rev-parse --verify HEAD
ecece54b1eb65d484444c4a5ca0b244b329f4667
ncn-m001# cd ..
</code></pre></div><p>The configuration parameters have been stored in a branch in the UAN git repository. The next phase of the process initiates the Configuration Framework Service (CFS) to customize the image.</p>
</li>
</ol>
<p><strong>CONFIGURE UAN IMAGES</strong></p>
<ol start="13">
<li>
<p>Create a JSON input file for generating a CFS configuration for the UAN.</p>
<p>Gather the git repository clone URL, commit, and top-level play for each configuration layer (that is, Cray product). Add them to the CFS configuration for the UAN, if needed.</p>
<p>For the commit value for the UAN layer, use the Git commit value obtained in the previous step.</p>
<p>See the product-specific documentation for further information on configuring other HPE products, as this procedure documents only the required configuration of the UAN. More layers can be added to be configured in a single CFS session.</p>
<p>The following configuration example can be used for preboot image customization as well as post-boot node configuration.</p>
<p>Note that the Slingshot Host Software CFS layer is listed first. This is required as the UAN layer will attempt to install DVS and Lustre packages that require SHS be installed first. The correct playbook for Cassini or Mellanox must also be specified. Consult the Slingshot Host Software documentation for more information.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
  <span style="color:#f92672">&#34;layers&#34;</span>: [
    {
      <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;shs-integration-SHS_PRODUCT_VERSION&#34;</span>,
      <span style="color:#f92672">&#34;cloneUrl&#34;</span>: <span style="color:#e6db74">&#34;https://api-gw-service-nmn.local/vcs/cray/slingshot-host-software-config-management.git&#34;</span>,
      <span style="color:#f92672">&#34;playbook&#34;</span>: <span style="color:#e6db74">&#34;shs_cassini_install.yml&#34;</span>
      <span style="color:#e6db74">&#34;commit&#34;</span>: <span style="color:#e6db74">&#34;45f891adb9a2e7ca304565b21b29f29226fa3e0f&#34;</span>,
    },
    {
      <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;uan-integration-PRODUCT_VERSION&#34;</span>,
      <span style="color:#f92672">&#34;cloneUrl&#34;</span>: <span style="color:#e6db74">&#34;https://api-gw-service-nmn.local/vcs/cray/uan-config-management.git&#34;</span>,
      <span style="color:#f92672">&#34;playbook&#34;</span>: <span style="color:#e6db74">&#34;site.yml&#34;</span>,
      <span style="color:#f92672">&#34;commit&#34;</span>: <span style="color:#e6db74">&#34;ecece54b1eb65d484444c4a5ca0b244b329f4667&#34;</span>
    }
    <span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#960050;background-color:#1e0010">**</span>{ <span style="color:#960050;background-color:#1e0010">...</span> <span style="color:#960050;background-color:#1e0010">add</span> <span style="color:#960050;background-color:#1e0010">configuration</span> <span style="color:#960050;background-color:#1e0010">layers</span> <span style="color:#960050;background-color:#1e0010">for</span> <span style="color:#960050;background-color:#1e0010">other</span> <span style="color:#960050;background-color:#1e0010">products</span> <span style="color:#960050;background-color:#1e0010">here,</span> <span style="color:#960050;background-color:#1e0010">if</span> <span style="color:#960050;background-color:#1e0010">desired</span> <span style="color:#960050;background-color:#1e0010">...</span> }<span style="color:#960050;background-color:#1e0010">**</span>
  ]
}
</code></pre></div></li>
<li>
<p>Add the configuration to CFS using the JSON input file.</p>
<p>In the following example, the JSON file created in the previous step is named <code>uan-config-PRODUCT_VERSION.json</code> only the details for the UAN layer are shown.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ncn-m001# cray cfs configurations update uan-config-PRODUCT_VERSION --file ./uan-config-PRODUCT_VERSION.json --format json
<span style="color:#f92672">{</span>
  <span style="color:#e6db74">&#34;lastUpdated&#34;</span>: <span style="color:#e6db74">&#34;2021-07-28T03:26:00:37Z&#34;</span>,
  <span style="color:#e6db74">&#34;layers&#34;</span>: <span style="color:#f92672">[</span>
    <span style="color:#f92672">{</span>
      <span style="color:#e6db74">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;shs-integration-SHS_PRODUCT_VERSION&#34;</span>,
      <span style="color:#e6db74">&#34;cloneUrl&#34;</span>: <span style="color:#e6db74">&#34;https://api-gw-service-nmn.local/vcs/cray/slingshot-host-software-config-management.git&#34;</span>,
      <span style="color:#e6db74">&#34;playbook&#34;</span>: <span style="color:#e6db74">&#34;shs_cassini_install.yml&#34;</span>
      <span style="color:#e6db74">&#34;commit&#34;</span>: <span style="color:#e6db74">&#34;45f891adb9a2e7ca304565b21b29f29226fa3e0f&#34;</span>,
    <span style="color:#f92672">}</span>,
    <span style="color:#f92672">{</span>
      <span style="color:#e6db74">&#34;cloneUrl&#34;</span>: <span style="color:#e6db74">&#34;https://api-gw-service-nmn.local/vcs/cray/uan-config-management.git&#34;</span>,
      <span style="color:#e6db74">&#34;commit&#34;</span>: <span style="color:#e6db74">&#34;ecece54b1eb65d484444c4a5ca0b244b329f4667&#34;</span>,
      <span style="color:#e6db74">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;uan-integration-PRODUCT_VERSION&#34;</span>,
      <span style="color:#e6db74">&#34;playbook&#34;</span>: <span style="color:#e6db74">&#34;site.yml&#34;</span>
    <span style="color:#f92672">}</span>  **# &lt;-- Additional layers not shown, but would be inserted here**
  <span style="color:#f92672">]</span>,
  <span style="color:#e6db74">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;uan-config-PRODUCT_VERSION&#34;</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>The UAN layer must be first as it configures the network interfaces that may be required by subsequent layers. When other products are added to the CFS configuration used to boot UANs, the suggested order of the layers would be:</p>
<ol>
<li>Slingshot Host Software (must be specified before UAN)</li>
<li>UAN</li>
<li>CPE (Cray Programming Environment)</li>
<li>Workload Manager (Either Slurm or PBS Pro)</li>
<li>Analytics</li>
<li>customer</li>
</ol>
</li>
<li>
<p>Create a CFS session to perform preboot image customization of the UAN image.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ncn-m001# cray cfs sessions create --name uan-config-PRODUCT_VERSION <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>                  --configuration-name uan-config-PRODUCT_VERSION <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>                  --target-definition image <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>                  --target-group Application IMAGE_ID <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>                  --target-group Application_UAN IMAGE_ID <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>                  --format json
</code></pre></div></li>
<li>
<p>Wait until the CFS configuration session for the image customization to complete. Then record the ID of the IMS image created by CFS.</p>
<p>The following command will produce output while the process is running. If the CFS session completes successfully, an IMS image ID will appear in the output.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ncn-m001# cray cfs sessions describe uan-config-PRODUCT_VERSION --format json | jq
</code></pre></div></li>
</ol>
<p><strong>PREPARE UAN BOOT SESSION TEMPLATES</strong></p>
<ol start="17">
<li>
<p>Retrieve the xnames of the UAN nodes from the Hardware State Manager (HSM).</p>
<p>These xnames are needed for Step 18.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ncn-m001# cray hsm state components list --role Application --subrole UAN --format json | jq -r .Components<span style="color:#f92672">[]</span>.ID
x3000c0s19b0n0
x3000c0s24b0n0
x3000c0s20b0n0
x3000c0s22b0n0
</code></pre></div></li>
<li>
<p>Construct a JSON BOS boot session template for the UAN.</p>
<p>a. Populate the template with the following information:</p>
<pre><code>- The xnames of Application nodes from Step 17
- The customized image ID from Step 16 for
- The CFS configuration session name from Step 14
</code></pre>
<p>b. Verify that the session template matches the format and structure in the following example.</p>
<p>The <code>kernel_parameters</code> field and value must all be on a single line.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
   <span style="color:#f92672">&#34;boot_sets&#34;</span>: {
     <span style="color:#f92672">&#34;uan&#34;</span>: {
       <span style="color:#f92672">&#34;boot_ordinal&#34;</span>: <span style="color:#ae81ff">2</span>,
       <span style="color:#f92672">&#34;kernel_parameters&#34;</span>: <span style="color:#e6db74">&#34;spire_join_token=${SPIRE_JOIN_TOKEN}&#34;</span>,
       <span style="color:#f92672">&#34;network&#34;</span>: <span style="color:#e6db74">&#34;nmn&#34;</span>,
       <span style="color:#f92672">&#34;node_list&#34;</span>: [
         <span style="color:#960050;background-color:#1e0010">**...</span> <span style="color:#960050;background-color:#1e0010">comma-separated</span> <span style="color:#960050;background-color:#1e0010">list</span> <span style="color:#960050;background-color:#1e0010">of</span> <span style="color:#960050;background-color:#1e0010">Application</span> <span style="color:#960050;background-color:#1e0010">Nodes</span> <span style="color:#960050;background-color:#1e0010">from</span> <span style="color:#960050;background-color:#1e0010">cray</span> <span style="color:#960050;background-color:#1e0010">hsm</span> <span style="color:#960050;background-color:#1e0010">state</span> <span style="color:#960050;background-color:#1e0010">command.</span> <span style="color:#960050;background-color:#1e0010">Surround</span> <span style="color:#960050;background-color:#1e0010">each</span> <span style="color:#960050;background-color:#1e0010">node</span> <span style="color:#960050;background-color:#1e0010">in</span> <span style="color:#960050;background-color:#1e0010">the</span> <span style="color:#960050;background-color:#1e0010">list</span> <span style="color:#960050;background-color:#1e0010">with</span> <span style="color:#960050;background-color:#1e0010">quotes...**</span>
       ],
       <span style="color:#f92672">&#34;path&#34;</span>: <span style="color:#e6db74">&#34;s3://boot-images/IMS_IMAGE_ID/manifest.json&#34;</span>,  <span style="color:#960050;background-color:#1e0010">**&lt;--</span> <span style="color:#960050;background-color:#1e0010">result_id</span> <span style="color:#960050;background-color:#1e0010">from</span> <span style="color:#960050;background-color:#1e0010">Step</span> <span style="color:#960050;background-color:#1e0010">15**</span>
       <span style="color:#f92672">&#34;rootfs_provider&#34;</span>: <span style="color:#e6db74">&#34;cpss3&#34;</span>,
       <span style="color:#f92672">&#34;rootfs_provider_passthrough&#34;</span>: <span style="color:#e6db74">&#34;dvs:api-gw-service-nmn.local:300:nmn0&#34;</span>,
       <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;s3&#34;</span>
     }
   },
   <span style="color:#f92672">&#34;cfs&#34;</span>: {
       <span style="color:#f92672">&#34;configuration&#34;</span>: <span style="color:#e6db74">&#34;uan-config-PRODUCT_VERSION&#34;</span> <span style="color:#960050;background-color:#1e0010">**&lt;--</span> <span style="color:#960050;background-color:#1e0010">PRODUCT_VERSION</span> <span style="color:#960050;background-color:#1e0010">from</span> <span style="color:#960050;background-color:#1e0010">Step</span> <span style="color:#ae81ff">1</span><span style="color:#960050;background-color:#1e0010">**</span>
   },
   <span style="color:#f92672">&#34;enable_cfs&#34;</span>: <span style="color:#66d9ef">true</span>,
   <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;uan-sessiontemplate-PRODUCT_VERSION&#34;</span> <span style="color:#960050;background-color:#1e0010">**&lt;--</span> <span style="color:#960050;background-color:#1e0010">PRODUCT_VERSION</span> <span style="color:#960050;background-color:#1e0010">from</span> <span style="color:#960050;background-color:#1e0010">Step</span> <span style="color:#ae81ff">1</span><span style="color:#960050;background-color:#1e0010">**</span>
 }
</code></pre></div><p>c. Save the template with a descriptive name, such as <code>uan-sessiontemplate-PRODUCT_VERSION.json</code>.</p>
</li>
<li>
<p>Register the session template with BOS.</p>
<p>The following command uses the JSON session template file to save a session template in BOS. This step allows administrators to boot UANs by referring to the session template name.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ncn-m001# cray bos sessiontemplate create <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>                   --name uan-sessiontemplate-PRODUCT_VERSION <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>                   --file uan-sessiontemplate-PRODUCT_VERSION.json
/sessionTemplate/uan-sessiontemplate-PRODUCT_VERSION
</code></pre></div></li>
<li>
<p>Perform <a href="/docs-uan/en-232/operations/boot_uans/#boot-uans">Boot UANs</a> to boot the UANs with the new image and BOS session template.</p>
</li>
</ol>


<footer class="footline">
	
</footer>

        
        </div>
        

      </div>

    <div id="navigation">
        
        

        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        

        


	 
	 
    </div>

    </section>

    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/docs-uan/js/clipboard.min.js?1649114394"></script>
    <script src="/docs-uan/js/perfect-scrollbar.min.js?1649114394"></script>
    <script src="/docs-uan/js/perfect-scrollbar.jquery.min.js?1649114394"></script>
    <script src="/docs-uan/js/jquery.sticky.js?1649114394"></script>
    <script src="/docs-uan/js/featherlight.min.js?1649114394"></script>
    <script src="/docs-uan/js/highlight.pack.js?1649114394"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/docs-uan/js/modernizr.custom-3.6.0.js?1649114394"></script>
    <script src="/docs-uan/js/learn.js?1649114394"></script>
    <script src="/docs-uan/js/hugo-learn.js?1649114394"></script>
    
        
            <script src="/docs-uan/mermaid/mermaid.js?1649114394"></script>
        
        <script>
            mermaid.initialize({ startOnLoad: true });
        </script>
    
    

  </body>
</html>

