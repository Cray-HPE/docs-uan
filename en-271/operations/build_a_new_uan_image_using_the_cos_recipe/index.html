<!DOCTYPE html>
<html lang="en-271" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.101.0" />
    <meta name="description" content="">


    <link rel="icon" href="/docs-uan/images/favicon.png" type="image/png">

    <title> :: User Access Node (UAN)</title>

    
    <link href="/docs-uan/css/nucleus.css?1707966277" rel="stylesheet">
    <link href="/docs-uan/css/fontawesome-all.min.css?1707966277" rel="stylesheet">
    <link href="/docs-uan/css/hybrid.css?1707966277" rel="stylesheet">
    <link href="/docs-uan/css/featherlight.min.css?1707966277" rel="stylesheet">
    <link href="/docs-uan/css/perfect-scrollbar.min.css?1707966277" rel="stylesheet">
    <link href="/docs-uan/css/auto-complete.css?1707966277" rel="stylesheet">
    <link href="/docs-uan/css/atom-one-dark-reasonable.css?1707966277" rel="stylesheet">
    <link href="/docs-uan/css/theme.css?1707966277" rel="stylesheet">
    <link href="/docs-uan/css/tabs.css?1707966277" rel="stylesheet">
    <link href="/docs-uan/css/hugo-theme.css?1707966277" rel="stylesheet">
    
    <link href="/docs-uan/css/theme-green.css?1707966277" rel="stylesheet">
    
    

    <script src="/docs-uan/js/jquery-3.3.1.min.js?1707966277"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
    </style>
    
    
  </head>
  <body class="" data-url="/docs-uan/en-271/operations/build_a_new_uan_image_using_the_cos_recipe/">
    <nav id="sidebar" class="">



  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href='/docs-uan/en-271'>
<img src=/docs-uan/images/hpe_pri_wht_rev_rgb.png alt="HPE" />
</a>

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="/docs-uan/js/lunr.min.js?1707966277"></script>
<script type="text/javascript" src="/docs-uan/js/auto-complete.js?1707966277"></script>
<script type="text/javascript">
    
        var baseurl = "\/docs-uan\/\/en-271";
    
</script>
<script type="text/javascript" src="/docs-uan/js/search.js?1707966277"></script>

    
  </div>
  

    <div class="highlightable">
    <ul class="topics">

        
          
          




 
  
    
    <li data-nav-id="/docs-uan/en-271/installation_prereqs/" title="" class="dd-item
        
        
        
        ">
      <a href="/docs-uan/en-271/installation_prereqs/">
          installation prereqs
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/docs-uan/en-271/installation_prereqs/prepare_for_uan_product_installation/" title="" class="dd-item ">
        <a href="/docs-uan/en-271/installation_prereqs/prepare_for_uan_product_installation/">
        Prepare for UAN Product Installation
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/docs-uan/en-271/installation_prereqs/configure_the_bmc_for_uans_with_ilo/" title="" class="dd-item ">
        <a href="/docs-uan/en-271/installation_prereqs/configure_the_bmc_for_uans_with_ilo/">
        Configure the BMC for UANs with iLO
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/docs-uan/en-271/installation_prereqs/configure_the_bios_of_an_hpe_uan/" title="" class="dd-item ">
        <a href="/docs-uan/en-271/installation_prereqs/configure_the_bios_of_an_hpe_uan/">
        Configure the BIOS of an HPE UAN
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/docs-uan/en-271/install/" title="" class="dd-item
        
        
        
        ">
      <a href="/docs-uan/en-271/install/">
          install
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/docs-uan/en-271/install/install_the_uan_product_stream/" title="" class="dd-item ">
        <a href="/docs-uan/en-271/install/install_the_uan_product_stream/">
        Install or Upgrade UAN
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/docs-uan/en-271/operations/" title="" class="dd-item
        parent
        
        
        ">
      <a href="/docs-uan/en-271/operations/">
          operations
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/docs-uan/en-271/operations/basic_uan_configuration/" title="" class="dd-item ">
        <a href="/docs-uan/en-271/operations/basic_uan_configuration/">
        Basic UAN Configuration
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/docs-uan/en-271/operations/build_a_new_uan_image_using_the_cos_recipe/" title="" class="dd-item active">
        <a href="/docs-uan/en-271/operations/build_a_new_uan_image_using_the_cos_recipe/">
        Build a New UAN Image Using a COS Recipe
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/docs-uan/en-271/operations/create_uan_boot_images/" title="" class="dd-item ">
        <a href="/docs-uan/en-271/operations/create_uan_boot_images/">
        Create UAN Boot Images
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/docs-uan/en-271/operations/mount_a_new_file_system_on_an_uan/" title="" class="dd-item ">
        <a href="/docs-uan/en-271/operations/mount_a_new_file_system_on_an_uan/">
        Mount a New File System on a UAN
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/docs-uan/en-271/operations/configure_interfaces_on_uans/" title="" class="dd-item ">
        <a href="/docs-uan/en-271/operations/configure_interfaces_on_uans/">
        Configure Interfaces on UANs
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/docs-uan/en-271/operations/configure_pluggable_authentication_modules_pam_on_uans/" title="" class="dd-item ">
        <a href="/docs-uan/en-271/operations/configure_pluggable_authentication_modules_pam_on_uans/">
        Configure Pluggable Authentication Modules (PAM) on UANs
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/docs-uan/en-271/operations/boot_uans/" title="" class="dd-item ">
        <a href="/docs-uan/en-271/operations/boot_uans/">
        Boot UANs
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/docs-uan/en-271/operations/cve-2023-0461/" title="" class="dd-item ">
        <a href="/docs-uan/en-271/operations/cve-2023-0461/">
        Mitigation for CVE-2023-0461
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/docs-uan/en-271/operations/uan_shadow/" title="" class="dd-item ">
        <a href="/docs-uan/en-271/operations/uan_shadow/">
        `UAN shadow`
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/docs-uan/en-271/operations/uan_motd/" title="" class="dd-item ">
        <a href="/docs-uan/en-271/operations/uan_motd/">
        `UAN motd`
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/docs-uan/en-271/operations/uan_packages/" title="" class="dd-item ">
        <a href="/docs-uan/en-271/operations/uan_packages/">
        `UAN packages`
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/docs-uan/en-271/operations/uan_hardening/" title="" class="dd-item ">
        <a href="/docs-uan/en-271/operations/uan_hardening/">
        `UAN hardening`
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/docs-uan/en-271/operations/uan_interfaces/" title="" class="dd-item ">
        <a href="/docs-uan/en-271/operations/uan_interfaces/">
        `UAN interfaces`
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/docs-uan/en-271/operations/uan_ldap/" title="" class="dd-item ">
        <a href="/docs-uan/en-271/operations/uan_ldap/">
        `UAN LDAP`
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/docs-uan/en-271/operations/uan_disk_config/" title="" class="dd-item ">
        <a href="/docs-uan/en-271/operations/uan_disk_config/">
        `UAN disk config`
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/docs-uan/en-271/operations/uan_gpg_keys/" title="" class="dd-item ">
        <a href="/docs-uan/en-271/operations/uan_gpg_keys/">
        `UAN gpg keys`
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/docs-uan/en-271/operations/uan_ca_cert/" title="" class="dd-item ">
        <a href="/docs-uan/en-271/operations/uan_ca_cert/">
        `UAN ca cert`
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/docs-uan/en-271/advanced/" title="" class="dd-item
        
        
        
        ">
      <a href="/docs-uan/en-271/advanced/">
          advanced
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/docs-uan/en-271/advanced/enabling_can_chn/" title="" class="dd-item ">
        <a href="/docs-uan/en-271/advanced/enabling_can_chn/">
        Enabling the Customer Access Network (CAN) or the Customer High Speed Network (CHN)
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/docs-uan/en-271/advanced/repurposing_compute_as_uan/" title="" class="dd-item ">
        <a href="/docs-uan/en-271/advanced/repurposing_compute_as_uan/">
        Repurposing a Compute Node as a UAN
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/docs-uan/en-271/advanced/designating_application_nodes_for_k3s/" title="" class="dd-item ">
        <a href="/docs-uan/en-271/advanced/designating_application_nodes_for_k3s/">
        Designating Application Nodes for K3s (Technical Preview)
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/docs-uan/en-271/advanced/enabling_k3s/" title="" class="dd-item ">
        <a href="/docs-uan/en-271/advanced/enabling_k3s/">
        Configuring a UAN for K3s (Technical Preview)
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/docs-uan/en-271/advanced/sles_image/" title="" class="dd-item ">
        <a href="/docs-uan/en-271/advanced/sles_image/">
        Booting an Application Node with a SLE HPC Image (Technical Preview)
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/docs-uan/en-271/upgrade/" title="" class="dd-item
        
        
        
        ">
      <a href="/docs-uan/en-271/upgrade/">
          upgrade
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/docs-uan/en-271/upgrade/notable_changes/" title="" class="dd-item ">
        <a href="/docs-uan/en-271/upgrade/notable_changes/">
        Notable Changes
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/docs-uan/en-271/upgrade/upgrades/" title="" class="dd-item ">
        <a href="/docs-uan/en-271/upgrade/upgrades/">
        Upgrades
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/docs-uan/en-271/troubleshooting/" title="" class="dd-item
        
        
        
        ">
      <a href="/docs-uan/en-271/troubleshooting/">
          troubleshooting
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/docs-uan/en-271/troubleshooting/troubleshoot_uan_boot_issues/" title="" class="dd-item ">
        <a href="/docs-uan/en-271/troubleshooting/troubleshoot_uan_boot_issues/">
        Troubleshoot UAN Boot Issues
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/docs-uan/en-271/troubleshooting/troubleshoot_uan_cfs_and_network_configuration_issues/" title="" class="dd-item ">
        <a href="/docs-uan/en-271/troubleshooting/troubleshoot_uan_cfs_and_network_configuration_issues/">
        Troubleshoot UAN CFS and Network Configuration Issues
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/docs-uan/en-271/troubleshooting/troubleshoot_uan_disk_configuration_issues/" title="" class="dd-item ">
        <a href="/docs-uan/en-271/troubleshooting/troubleshoot_uan_disk_configuration_issues/">
        Troubleshoot UAN Disk Configuration Issues
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/docs-uan/en-271/test-plan/" title="" class="dd-item
        
        
        
        ">
      <a href="/docs-uan/en-271/test-plan/">
          test-plan
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/docs-uan/en-271/test-plan/test-plan/" title="" class="dd-item ">
        <a href="/docs-uan/en-271/test-plan/test-plan/">
        Test Plan for User Access Node (UAN) and Repurposed Compute Node as UAN
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
        
    </ul>

    
    

    
    <section id="prefooter">
      <hr/>
      <ul>
      
        <li>
          <a class="padding">
            
            Version: 
          <div class="select-style">
            <select id="select-language" onchange="location = this.value;">
          
          
          
              
              
                  
                    
                    
                      <option id="en-271" value="/docs-uan/en-271/operations/build_a_new_uan_image_using_the_cos_recipe/" selected>2.7.1</option>
                    
                  
              
                  
              
                  
              
                  
              
                  
              
          
              
              
                  
              
                  
                    
                    
                      <option id="en-270" value="/docs-uan/en-270/operations/build_a_new_uan_image_using_the_cos_recipe/">2.7.0</option>
                    
                  
              
                  
              
                  
              
                  
              
          
              
              
                  
              
                  
              
                  
                    
                    
                      <option id="en-262" value="/docs-uan/en-262/operations/build_a_new_uan_image_using_the_cos_recipe/">2.6.2</option>
                    
                  
              
                  
              
                  
              
          
              
              
                  
              
                  
              
                  
              
                  
                    
                    
                      <option id="en-261" value="/docs-uan/en-261/operations/build_a_new_uan_image_using_the_cos_recipe/">2.6.1</option>
                    
                  
              
                  
              
          
              
              
                  
              
                  
              
                  
              
                  
              
                  
                    
                    
                      <option id="en-2511" value="/docs-uan/en-2511/operations/build_a_new_uan_image_using_the_cos_recipe/">2.5.11</option>
                    
                  
              
          
        </select>
        <svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
          width="255px" height="255px" viewBox="0 0 255 255" style="enable-background:new 0 0 255 255;" xml:space="preserve">
          <g>
            <g id="arrow-drop-down">
              <polygon points="0,63.75 127.5,191.25 255,63.75 		" />
            </g>
          </g>
        </svg>
        </div>
        </a>
        </li>
      

      
      </ul>
    </section>
    
    <section id="footer">
      
    </section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            
            
          
          
            <a href='/docs-uan/en-271/'></a> > <a href='/docs-uan/en-271/operations/'></a> > 
          
        
          
        
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
  <ul>
    <li><a href="#using-iuf-to-build-a-new-uan-image-uan-26">Using IUF to Build a New UAN Image (UAN 2.6+)</a></li>
    <li><a href="#manually-build-a-new-uan-image-from-a-cos-recipe-uan-23">Manually Build a New UAN Image from a COS Recipe (UAN 2.3+)</a></li>
  </ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              
            </h1>
          

        


<h1 id="build-a-new-uan-image-using-a-cos-recipe">Build a New UAN Image Using a COS Recipe</h1>
<p>Prior to HPE Cray Supercomputing UAN release 2.3, a similar copy of the COS image recipe was imported with the UAN install. Beginning with the 2.3 release, this product does not install an image recipe. A COS image recipe must be used. Additional UAN packages will be installed by CFS and the <code>uan_packages</code> role. In UAN release 2.6, this procedure is automated as part of the IUF process of installing and upgrading the UAN product. See <a href="/docs-uan/en-271/install/install_the_uan_product_stream/">Install or Upgrade UAN</a> for details.</p>
<p>The following procedures are provided for cases where a new UAN image must be built after initial installation. This document describes two methods of building UAN images:</p>
<ul>
<li><a href="#using-iuf-to-build-a-new-uan-image-uan-26">Using IUF to Build a New UAN Image (UAN 2.6+)</a>: use this procedure if you are using the IUF automation and the UAN software release version is 2.6 or later.</li>
<li><a href="#manually-build-a-new-uan-image-from-a-cos-recipe-uan-23">Manually Build a New UAN Image from a COS Recipe (UAN 2.3+)</a>: use this procedure if you are not using the IUF automation or the UAN software release is earlier than 2.6 and later than 2.3.</li>
</ul>
<h2 id="using-iuf-to-build-a-new-uan-image-uan-26">Using IUF to Build a New UAN Image (UAN 2.6+)</h2>
<p>The procedure for using IUF to build and prepare images is documented in the <a href="https://cray-hpe.github.io/docs-csm/en-15/operations/iuf/workflows/image_preparation/">Image Preparation</a> section of the CSM documentation. After IUF runs, the UAN CFS configuration will be created, the UAN image will be configured using that configuration, and the UAN BOS session template will be created using the new configuration and image.</p>
<p>The following information is provided for reference.</p>
<p>Two IUF stages are run to create a new UAN image:</p>
<ol>
<li><code>update-cfs-config</code>: Creates a new CFS configuration defined by the information in the bootprep file.</li>
<li><code>prepare-images</code>: Applies the new CFS configuration to the image defined in the bootprep file.</li>
</ol>
<p>After IUF runs these two stages, the UAN CFS configuration will be created, the UAN image will be configured using that configuration, and a UAN BOS session template will be created using the new configuration and image.</p>
<p>Before using IUF to build a new UAN image from a COS recipe, be sure that the information in the IUF Recipe Variables file (<code>product_vars.yaml</code>) and bootprep file (<code>compute-and-uan-bootprep.yaml</code>) are correct for the wanted UAN CFS configuration and the COS image recipe.</p>
<ul>
<li>
<p>Example <code>product_vars.yaml</code> showing COS and UAN versions and working VCS branches:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>cos:
</span></span><span style="display:flex;"><span>  version: 2.5.120 <span style="color:#75715e"># Provides the COS image to use as a base UAN image</span>
</span></span><span style="display:flex;"><span>  working_branch: <span style="color:#e6db74">&#34;{{ working_branch }}&#34;</span> <span style="color:#75715e"># COS CFS branch to use (typically matches compute nodes)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>uan:
</span></span><span style="display:flex;"><span>  version: 2.6.0 <span style="color:#75715e"># Provides the UAN CFS configuration</span>
</span></span><span style="display:flex;"><span>  working_branch: <span style="color:#e6db74">&#34;{{ working_branch }}&#34;</span> <span style="color:#75715e"># Provides the UAN CFS branch to use</span>
</span></span></code></pre></div></li>
<li>
<p>Example <code>compute-and-uan-bootprep.yaml</code> showing UAN CFS configuration and images (COS and UAN):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>configurations:
</span></span><span style="display:flex;"><span>- name: <span style="color:#e6db74">&#34;{{default.note}}uan-{{recipe.version}}{{default.suffix}}&#34;</span>
</span></span><span style="display:flex;"><span>  layers:
</span></span><span style="display:flex;"><span>  - name: shs-<span style="color:#f92672">{{</span>default.network_type<span style="color:#f92672">}}</span>_install-<span style="color:#f92672">{{</span>slingshot_host_software.working_branch<span style="color:#f92672">}}</span>
</span></span><span style="display:flex;"><span>    playbook: shs_<span style="color:#f92672">{{</span>default.network_type<span style="color:#f92672">}}</span>_install.yml
</span></span><span style="display:flex;"><span>    product:
</span></span><span style="display:flex;"><span>      name: slingshot-host-software
</span></span><span style="display:flex;"><span>      version: <span style="color:#e6db74">&#34;{{slingshot_host_software.version}}&#34;</span>
</span></span><span style="display:flex;"><span>      branch: <span style="color:#e6db74">&#34;{{slingshot_host_software.working_branch}}&#34;</span>
</span></span><span style="display:flex;"><span>  - name: cos-application-<span style="color:#f92672">{{</span>cos.working_branch<span style="color:#f92672">}}</span>
</span></span><span style="display:flex;"><span>    playbook: cos-application.yml
</span></span><span style="display:flex;"><span>    product:
</span></span><span style="display:flex;"><span>      name: cos
</span></span><span style="display:flex;"><span>      version: <span style="color:#e6db74">&#34;{{cos.version}}&#34;</span>
</span></span><span style="display:flex;"><span>      branch: <span style="color:#e6db74">&#34;{{cos.working_branch}}&#34;</span>
</span></span><span style="display:flex;"><span>  - name: csm-packages-<span style="color:#f92672">{{</span>csm.version<span style="color:#f92672">}}</span>
</span></span><span style="display:flex;"><span>    playbook: csm_packages.yml
</span></span><span style="display:flex;"><span>    product:
</span></span><span style="display:flex;"><span>      name: csm
</span></span><span style="display:flex;"><span>      version: <span style="color:#e6db74">&#34;{{csm.version}}&#34;</span>
</span></span><span style="display:flex;"><span>  - name: uan-<span style="color:#f92672">{{</span>uan.working_branch<span style="color:#f92672">}}</span>
</span></span><span style="display:flex;"><span>    playbook: site.yml
</span></span><span style="display:flex;"><span>    product:
</span></span><span style="display:flex;"><span>      name: uan
</span></span><span style="display:flex;"><span>      version: <span style="color:#e6db74">&#34;{{uan.version}}&#34;</span>
</span></span><span style="display:flex;"><span>      branch: <span style="color:#e6db74">&#34;{{uan.working_branch}}&#34;</span>
</span></span><span style="display:flex;"><span>  - name: csm-diags-application-<span style="color:#f92672">{{</span>csm_diags.version<span style="color:#f92672">}}</span>
</span></span><span style="display:flex;"><span>    playbook: csm-diags-application.yml
</span></span><span style="display:flex;"><span>    product:
</span></span><span style="display:flex;"><span>      name: csm-diags
</span></span><span style="display:flex;"><span>      version: <span style="color:#e6db74">&#34;{{csm_diags.version}}&#34;</span>
</span></span><span style="display:flex;"><span>  - name: sma-ldms-application-<span style="color:#f92672">{{</span>sma.version<span style="color:#f92672">}}</span>
</span></span><span style="display:flex;"><span>    playbook: sma-ldms-application.yml
</span></span><span style="display:flex;"><span>    product:
</span></span><span style="display:flex;"><span>      name: sma
</span></span><span style="display:flex;"><span>      version: <span style="color:#e6db74">&#34;{{sma.version}}&#34;</span>
</span></span><span style="display:flex;"><span>  - name: cpe-pe_deploy-<span style="color:#f92672">{{</span>cpe.working_branch<span style="color:#f92672">}}</span>
</span></span><span style="display:flex;"><span>    playbook: pe_deploy.yml
</span></span><span style="display:flex;"><span>    product:
</span></span><span style="display:flex;"><span>      name: cpe
</span></span><span style="display:flex;"><span>      version: <span style="color:#e6db74">&#34;{{cpe.version}}&#34;</span>
</span></span><span style="display:flex;"><span>      branch: <span style="color:#e6db74">&#34;{{cpe.working_branch}}&#34;</span>
</span></span><span style="display:flex;"><span>  - name: analytics-site-<span style="color:#f92672">{{</span>analytics.working_branch<span style="color:#f92672">}}</span>
</span></span><span style="display:flex;"><span>    playbook: site.yml
</span></span><span style="display:flex;"><span>    product:
</span></span><span style="display:flex;"><span>      name: analytics
</span></span><span style="display:flex;"><span>      version: <span style="color:#e6db74">&#34;{{analytics.version}}&#34;</span>
</span></span><span style="display:flex;"><span>      branch: <span style="color:#e6db74">&#34;{{analytics.working_branch}}&#34;</span>
</span></span><span style="display:flex;"><span>  - name: slurm-site-<span style="color:#f92672">{{</span>slurm.working_branch<span style="color:#f92672">}}</span>
</span></span><span style="display:flex;"><span>    playbook: site.yml
</span></span><span style="display:flex;"><span>    product:
</span></span><span style="display:flex;"><span>      name: slurm
</span></span><span style="display:flex;"><span>      version: <span style="color:#e6db74">&#34;{{slurm.version}}&#34;</span>
</span></span><span style="display:flex;"><span>      branch: <span style="color:#e6db74">&#34;{{slurm.working_branch}}&#34;</span>
</span></span><span style="display:flex;"><span>  - name: cos-application-last-<span style="color:#f92672">{{</span>cos.working_branch<span style="color:#f92672">}}</span>
</span></span><span style="display:flex;"><span>    playbook: cos-application-after.yml
</span></span><span style="display:flex;"><span>    product:
</span></span><span style="display:flex;"><span>      name: cos
</span></span><span style="display:flex;"><span>      version: <span style="color:#e6db74">&#34;{{cos.version}}&#34;</span>
</span></span><span style="display:flex;"><span>      branch: <span style="color:#e6db74">&#34;{{cos.working_branch}}&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>images:
</span></span><span style="display:flex;"><span><span style="color:#75715e"># images that use base.name will inherit the note and suffix in their name</span>
</span></span><span style="display:flex;"><span>- name: <span style="color:#e6db74">&#34;{{default.note}}{{base.name}}{{default.suffix}}&#34;</span>
</span></span><span style="display:flex;"><span>  ref_name: base_cos_image
</span></span><span style="display:flex;"><span>  base:
</span></span><span style="display:flex;"><span>    product:
</span></span><span style="display:flex;"><span>      name: cos
</span></span><span style="display:flex;"><span>      type: recipe
</span></span><span style="display:flex;"><span>      version: <span style="color:#e6db74">&#34;{{cos.version}}&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>- name: <span style="color:#e6db74">&#34;compute-{{base.name}}&#34;</span>
</span></span><span style="display:flex;"><span>  ref_name: compute_image
</span></span><span style="display:flex;"><span>  base:
</span></span><span style="display:flex;"><span>    image_ref: base_cos_image
</span></span><span style="display:flex;"><span>  configuration: <span style="color:#e6db74">&#34;{{default.note}}compute-{{recipe.version}}{{default.suffix}}&#34;</span>
</span></span><span style="display:flex;"><span>  configuration_group_names:
</span></span><span style="display:flex;"><span>  - Compute
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>- name: <span style="color:#e6db74">&#34;uan-{{base.name}}&#34;</span>
</span></span><span style="display:flex;"><span>  ref_name: uan_image
</span></span><span style="display:flex;"><span>  base:
</span></span><span style="display:flex;"><span>    image_ref: base_cos_image
</span></span><span style="display:flex;"><span>  configuration: <span style="color:#e6db74">&#34;{{default.note}}uan-{{recipe.version}}{{default.suffix}}&#34;</span>
</span></span><span style="display:flex;"><span>  configuration_group_names:
</span></span><span style="display:flex;"><span>  - Application
</span></span><span style="display:flex;"><span>  - Application_UAN
</span></span></code></pre></div></li>
</ul>
<p>After the <code>product_vars.yaml</code> and <code>compute-and-uan-bootprep.yaml</code> files are updated to reflect the wanted COS and UAN versions and VCS branches to use, IUF may be executed.</p>
<h2 id="manually-build-a-new-uan-image-from-a-cos-recipe-uan-23">Manually Build a New UAN Image from a COS Recipe (UAN 2.3+)</h2>
<p>Perform the following before starting this procedure:</p>
<ul>
<li>Install the COS, Slingshot, and UAN product streams.</li>
<li>Initialize the cray administrative CLI.</li>
</ul>
<p>In the COS recipe for 2.2, several dependencies have been removed, including Slingshot, DVS, and Lustre. Those packages are now installed during CFS Image Customization. More information on this change is covered in the <a href="/docs-uan/en-271/operations/create_uan_boot_images/">Create UAN Boot Images</a> procedure.</p>
<ol>
<li>
<p>Identify the COS image recipe to base the UAN image on. Select the recipe that matches the version of COS that the compute nodes will be using.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ncn-m001# cray ims recipes list --format json | jq <span style="color:#e6db74">&#39;.[] | select(.name | contains(&#34;compute&#34;))&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;created&#34;</span>: <span style="color:#e6db74">&#34;2021-02-17T15:19:48.549383+00:00&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;id&#34;</span>: <span style="color:#e6db74">&#34;4a5d1178-80ad-4151-af1b-bbe1480958d1&#34;</span>,  &lt;&lt;-- Note this ID
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;link&#34;</span>: <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;etag&#34;</span>: <span style="color:#e6db74">&#34;3c3b292364f7739da966c9cdae096964&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;path&#34;</span>: <span style="color:#e6db74">&#34;s3://ims/recipes/4a5d1178-80ad-4151-af1b-bbe1480958d1/recipe.tar.gz&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;s3&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">}</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;linux_distribution&#34;</span>: <span style="color:#e6db74">&#34;sles15&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;cray-shasta-compute-sles15sp3.x86_64-2.2.27&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;recipe_type&#34;</span>: <span style="color:#e6db74">&#34;kiwi-ng&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div></li>
<li>
<p>Save the id of the IMS recipe in an environment variable.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ncn-m001# IMS_RECIPE_ID<span style="color:#f92672">=</span>4a5d1178-80ad-4151-af1b-bbe1480958d1
</span></span></code></pre></div></li>
<li>
<p>Use the IMS recipe id to build the UAN image:</p>
<p>More detail on this IMS procedure may be found in the procedure &ldquo;Build an Image Using IMS REST Service&rdquo; in the CSM documentation.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ncn-m001# IMS_PUBLIC_KEY<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>cray ims public-keys list --format json | jq -r <span style="color:#e6db74">&#34;.[] | .id&#34;</span> | head -1<span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>ncn-m001# IMS_ARCHIVE_NAME<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>cray ims recipes describe $IMS_RECIPE_ID --format json | jq -r .name<span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>ncn-m001# IMS_ARCHIVE_NAME<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>IMS_ARCHIVE_NAME/compute/uan<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>ncn-m001# cray ims jobs create --job-type create --public-key-id $IMS_PUBLIC_KEY --image-root-archive-name $IMS_ARCHIVE_NAME --artifact-id $IMS_RECIPE_ID
</span></span></code></pre></div></li>
<li>
<p>Perform <a href="/docs-uan/en-271/operations/create_uan_boot_images/">Create UAN Boot Images</a> to run CFS Image Customization on the resulting image.</p>
</li>
</ol>


<footer class="footline">
	
</footer>

        
        </div>
        

      </div>

    <div id="navigation">
        
        

        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        

        


	 
	 
    </div>

    </section>

    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/docs-uan/js/clipboard.min.js?1707966277"></script>
    <script src="/docs-uan/js/perfect-scrollbar.min.js?1707966277"></script>
    <script src="/docs-uan/js/perfect-scrollbar.jquery.min.js?1707966277"></script>
    <script src="/docs-uan/js/jquery.sticky.js?1707966277"></script>
    <script src="/docs-uan/js/featherlight.min.js?1707966277"></script>
    <script src="/docs-uan/js/highlight.pack.js?1707966277"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/docs-uan/js/modernizr.custom-3.6.0.js?1707966277"></script>
    <script src="/docs-uan/js/learn.js?1707966277"></script>
    <script src="/docs-uan/js/hugo-learn.js?1707966277"></script>
    
        
            <script src="/docs-uan/mermaid/mermaid.js?1707966277"></script>
        
        <script>
            mermaid.initialize({ startOnLoad: true });
        </script>
    
    

  </body>
</html>

