<!DOCTYPE html>
<html lang="en-255" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="generator" content="Hugo 0.101.0">
    <meta name="generator" content="Relearn 5.8.1+tip">
    <meta name="robots" content="noindex, nofollow, noarchive, noimageindex">
    <meta name="description" content="">
    <title>User Access Node (UAN)</title>
    <!-- https://github.com/filamentgroup/loadCSS/blob/master/README.md#how-to-use -->
    <link href="/docs-uan/css/fontawesome-all.min.css?1670951100" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/docs-uan/css/fontawesome-all.min.css?1670951100" rel="stylesheet"></noscript>
    <link href="/docs-uan/css/featherlight.min.css?1670951100" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/docs-uan/css/featherlight.min.css?1670951100" rel="stylesheet"></noscript>
    <link href="/docs-uan/css/auto-complete.css?1670951100" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/docs-uan/css/auto-complete.css?1670951100" rel="stylesheet"></noscript>
    <link href="/docs-uan/css/perfect-scrollbar.min.css?1670951100" rel="stylesheet">
    <link href="/docs-uan/css/nucleus.css?1670951100" rel="stylesheet">
    <link href="/docs-uan/css/fonts.css?1670951100" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/docs-uan/css/fonts.css?1670951100" rel="stylesheet"></noscript>
    <link href="/docs-uan/css/theme.css?1670951100" rel="stylesheet">
    <link href="/docs-uan/css/theme-green.css?1670951100" rel="stylesheet" id="variant-style">
    <link href="/docs-uan/css/ie.css?1670951100" rel="stylesheet">
    <link href="/docs-uan/css/variant.css?1670951100" rel="stylesheet">
    <link href="/docs-uan/css/print.css?1670951100" rel="stylesheet" media="print">
    <script src="/docs-uan/js/url.js?1670951100"></script>
    <script src="/docs-uan/js/variant.js?1670951100"></script>
    <script>
      // hack to let hugo tell us how to get to the root when using relativeURLs, it needs to be called *url= for it to do its magic:
      // https://github.com/gohugoio/hugo/blob/145b3fcce35fbac25c7033c91c1b7ae6d1179da8/transform/urlreplacers/absurlreplacer.go#L72
      window.index_js_url="/docs-uan/index.search.js";
      var root_url="/";
      var baseUri=root_url.replace(/\/$/, '');
      // translations
      window.T_Copy_to_clipboard = '';
      window.T_Copied_to_clipboard = '';
      window.T_Copy_link_to_clipboard = '';
      window.T_Link_copied_to_clipboard = '';
      window.T_No_results_found = '';
      window.T_N_results_found = '';
      // some further base stuff
      var baseUriFull='docs-uan/';
      window.variants && variants.init( [ 'green' ] );
    </script>
    <script src="/docs-uan/js/jquery.min.js?1670951100" defer></script>
  </head>
  <body class="mobile-support html" data-url="/docs-uan/operations/build_a_new_uan_image_using_the_cos_recipe/index.html">
    <div id="body" class="default-animation">
      <div id="sidebar-overlay"></div>
      <div id="toc-overlay"></div>
      <nav id="topbar" class="highlightable" dir="ltr">
        <div>
          <div id="breadcrumbs">
            <span id="sidebar-toggle-span">
              <a href="#" id="sidebar-toggle" title=' (CTRL+ALT+n)'><i class="fas fa-bars fa-fw"></i></a>
            </span>
            <ol class="links" itemscope itemtype="http://schema.org/BreadcrumbList">
              <li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><a itemprop="item" href="/docs-uan/index.html"><span itemprop="name">User Access Node (UAN)</span></a><meta itemprop="position" content="1"> > </li>
              <li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><a itemprop="item" href="/docs-uan/operations/index.html"><span itemprop="name">User Access Node (UAN)</span></a><meta itemprop="position" content="2"> > </li>
              <li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><span itemprop="name">User Access Node (UAN)</span><meta itemprop="position" content="3"></li>
            </ol>
          </div>
        </div>
      </nav>
      <main id="body-inner" class="highlightable default" tabindex="-1">
        <div class="flex-block-wrapper">
          <div id="head-tags">
          </div>
          <article class="default">
<h1 id=""></h1>

<h1 id="build-a-new-uan-image-using-a-cos-recipe">Build a New UAN Image Using a COS Recipe</h1>
<p>Prior to UAN 2.3, a similar copy of the COS recipe was imported with the UAN install. In the UAN 2.3 release, UAN does not install a recipe, and a COS recipe must be used. Additional uan packages will now be installed via CFS and the <code>uan_packages</code> role.</p>
<p>Perform the following before starting this procedure:</p>
<ul>
<li>Install the COS, Slingshot, and UAN product streams.</li>
<li>Initialize the cray administrative CLI.</li>
</ul>
<p>In the COS recipe for 2.2, several dependencies have been removed, this includes Slingshot, DVS, and Lustre. Those packages are now installed during CFS Image Customization. More information on this change is covered in the <a href="/docs-uan/operations/create_uan_boot_images/#create-boot-images">Create UAN Boot Images</a> procedure.</p>
<ol>
<li>
<p>Identify the COS image recipe to base the UAN image on. Select the recipe that matches the version of COS that the compute nodes will be using.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ncn-m001# cray ims recipes list --format json | jq <span style="color:#e6db74">&#39;.[] | select(.name | contains(&#34;compute&#34;))&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;created&#34;</span>: <span style="color:#e6db74">&#34;2021-02-17T15:19:48.549383+00:00&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;id&#34;</span>: <span style="color:#e6db74">&#34;4a5d1178-80ad-4151-af1b-bbe1480958d1&#34;</span>,  &lt;&lt;-- Note this ID
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;link&#34;</span>: <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;etag&#34;</span>: <span style="color:#e6db74">&#34;3c3b292364f7739da966c9cdae096964&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;path&#34;</span>: <span style="color:#e6db74">&#34;s3://ims/recipes/4a5d1178-80ad-4151-af1b-bbe1480958d1/recipe.tar.gz&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;s3&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">}</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;linux_distribution&#34;</span>: <span style="color:#e6db74">&#34;sles15&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;cray-shasta-compute-sles15sp3.x86_64-2.2.27&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;recipe_type&#34;</span>: <span style="color:#e6db74">&#34;kiwi-ng&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div></li>
<li>
<p>Save the id of the IMS recipe in an environment variable.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ncn-m001# IMS_RECIPE_ID<span style="color:#f92672">=</span>4a5d1178-80ad-4151-af1b-bbe1480958d1
</span></span></code></pre></div></li>
<li>
<p>Use the IMS recipe id to build the UAN image:</p>
<p>More detail on this IMS procedure may be found in the procedure &ldquo;Build an Image Using IMS REST Service&rdquo; in the CSM documentation.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ncn-m001# IMS_PUBLIC_KEY<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>cray ims public-keys list --format json | jq -r <span style="color:#e6db74">&#34;.[] | .id&#34;</span> | head -1<span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>ncn-m001# IMS_ARCHIVE_NAME<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>cray ims recipes describe $IMS_RECIPE_ID --format json | jq -r .name<span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>ncn-m001# IMS_ARCHIVE_NAME<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>IMS_ARCHIVE_NAME/compute/uan<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>ncn-m001# cray ims jobs create --job-type create --public-key-id $IMS_PUBLIC_KEY --image-root-archive-name $IMS_ARCHIVE_NAME --artifact-id $IMS_RECIPE_ID
</span></span></code></pre></div></li>
<li>
<p>Perform <a href="/docs-uan/operations/create_uan_boot_images/#create-boot-images">Create UAN Boot Images</a> to run CFS Image Customization on the resulting image.</p>
</li>
</ol>

            <footer class="footline">
            </footer>
          </article>
        </div>
      </main>
    </div>
    <aside id="sidebar" class="default-animation" dir="ltr">
      <div id="header-wrapper" class="default-animation">
        <div id="header" class="default-animation">
<a id="logo" href='/docs-uan/'>
  <img src="/docs-uan/images/hpe.png" alt="HPE" />
</a>
        </div>
        <div class="searchbox default-animation">
          <i class="fas fa-search" title=" (CTRL+ALT+f)"></i>
          <label class="a11y-only" for="search-by"></label>
          <input data-search-input id="search-by" name="search-by" class="search-by" type="search" placeholder="">
          <span data-search-clear=""><i class="fas fa-times"></i></span>
        </div>
        <script>
          var contentLangs=['en'];
        </script>
        <script src="/docs-uan/js/auto-complete.js?1670951100" defer></script>
        <script src="/docs-uan/js/lunr.min.js?1670951100" defer></script>
        <script src="/docs-uan/js/lunr.stemmer.support.min.js?1670951100" defer></script>
        <script src="/docs-uan/js/lunr.multi.min.js?1670951100" defer></script>
        <script src="/docs-uan/js/lunr.en.min.js?1670951100" defer></script>
        <script src="/docs-uan/js/search.js?1670951100" defer></script>
      </div>
      <div id="content-wrapper" class="highlightable">
        <ul class="topics">
          <li data-nav-id="/docs-uan/operations/index.html" class="dd-item parent"><a href="/docs-uan/operations/index.html">Operations</a><ul id="subsections-2793aa64e5a9807639f49b7448d0fca1">
          <li data-nav-id="/docs-uan/operations/build_a_new_uan_image_using_the_cos_recipe/index.html" class="dd-item active"><a href="/docs-uan/operations/build_a_new_uan_image_using_the_cos_recipe/index.html">Build A New UAN Image Using A COS Recipe</a></li></ul></li>
        </ul>
        <div class="footermargin footerLangSwitch footerVariantSwitch footerVisitedLinks footerFooter showFooter"></div>
        <hr class="default-animation footerLangSwitch footerVariantSwitch footerVisitedLinks footerFooter showFooter">
        <div id="prefooter" class="footerLangSwitch footerVariantSwitch footerVisitedLinks">
          <ul>
            <li id="select-language-container" class="footerLangSwitch">
              <div class="padding select-container">
                <i class="fas fa-language fa-fw"></i>
                <span>&nbsp;</span>
                <div class="select-style">
                  <label class="a11y-only" for="select-language"></label>
                  <select id="select-language" onchange="location = baseUri + this.value;">
                  </select>
                </div>
                <div class="select-clear"></div>
              </div>
            </li>
            <li id="select-variant-container" class="footerVariantSwitch">
              <div class="padding select-container">
                <i class="fas fa-paint-brush fa-fw"></i>
                <span>&nbsp;</span>
                <div class="select-style">
                  <label class="a11y-only" for="select-variant"></label>
                  <select id="select-variant" onchange="window.variants && variants.changeVariant( this.value );">
                    <option id="green" value="green" selected>Green</option>
                  </select>
                </div>
                <div class="select-clear"></div>
              </div>
              <script>window.variants && variants.markSelectedVariant();</script>
            </li>
            <li class="footerVisitedLinks"><button class="padding" onclick="clearHistory();"><i class="fas fa-history fa-fw"></i> </button></li>
          </ul>
        </div>
        <div id="footer" class="footerFooter showFooter">
	    <p>Built with <a href="https://github.com/McShelby/hugo-theme-relearn" title="love"><i class="fas fa-heart"></i></a> by <a href="https://gohugo.io/">Hugo</a></p>
        </div>
      </div>
    </aside>
    <script src="/docs-uan/js/clipboard.min.js?1670951100" defer></script>
    <script src="/docs-uan/js/perfect-scrollbar.min.js?1670951100" defer></script>
    <script src="/docs-uan/js/featherlight.min.js?1670951100" defer></script>
    <script src="/docs-uan/js/theme.js?1670951100" defer></script>
  </body>
</html>
