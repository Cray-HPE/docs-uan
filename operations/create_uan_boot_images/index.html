<!DOCTYPE html>
<html lang="en-255" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="generator" content="Hugo 0.101.0">
    <meta name="generator" content="Relearn 5.8.1+tip">
    <meta name="robots" content="noindex, nofollow, noarchive, noimageindex">
    <meta name="description" content="">
    <title>User Access Node (UAN)</title>
    <!-- https://github.com/filamentgroup/loadCSS/blob/master/README.md#how-to-use -->
    <link href="/docs-uan/css/fontawesome-all.min.css?1670951100" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/docs-uan/css/fontawesome-all.min.css?1670951100" rel="stylesheet"></noscript>
    <link href="/docs-uan/css/featherlight.min.css?1670951100" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/docs-uan/css/featherlight.min.css?1670951100" rel="stylesheet"></noscript>
    <link href="/docs-uan/css/auto-complete.css?1670951100" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/docs-uan/css/auto-complete.css?1670951100" rel="stylesheet"></noscript>
    <link href="/docs-uan/css/perfect-scrollbar.min.css?1670951100" rel="stylesheet">
    <link href="/docs-uan/css/nucleus.css?1670951100" rel="stylesheet">
    <link href="/docs-uan/css/fonts.css?1670951100" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/docs-uan/css/fonts.css?1670951100" rel="stylesheet"></noscript>
    <link href="/docs-uan/css/theme.css?1670951100" rel="stylesheet">
    <link href="/docs-uan/css/theme-green.css?1670951100" rel="stylesheet" id="variant-style">
    <link href="/docs-uan/css/ie.css?1670951100" rel="stylesheet">
    <link href="/docs-uan/css/variant.css?1670951100" rel="stylesheet">
    <link href="/docs-uan/css/print.css?1670951100" rel="stylesheet" media="print">
    <script src="/docs-uan/js/url.js?1670951100"></script>
    <script src="/docs-uan/js/variant.js?1670951100"></script>
    <script>
      // hack to let hugo tell us how to get to the root when using relativeURLs, it needs to be called *url= for it to do its magic:
      // https://github.com/gohugoio/hugo/blob/145b3fcce35fbac25c7033c91c1b7ae6d1179da8/transform/urlreplacers/absurlreplacer.go#L72
      window.index_js_url="/docs-uan/index.search.js";
      var root_url="/";
      var baseUri=root_url.replace(/\/$/, '');
      // translations
      window.T_Copy_to_clipboard = '';
      window.T_Copied_to_clipboard = '';
      window.T_Copy_link_to_clipboard = '';
      window.T_Link_copied_to_clipboard = '';
      window.T_No_results_found = '';
      window.T_N_results_found = '';
      // some further base stuff
      var baseUriFull='docs-uan/';
      window.variants && variants.init( [ 'green' ] );
    </script>
    <script src="/docs-uan/js/jquery.min.js?1670951100" defer></script>
  </head>
  <body class="mobile-support html" data-url="/docs-uan/operations/create_uan_boot_images/index.html">
    <div id="body" class="default-animation">
      <div id="sidebar-overlay"></div>
      <div id="toc-overlay"></div>
      <nav id="topbar" class="highlightable" dir="ltr">
        <div>
          <div id="breadcrumbs">
            <span id="sidebar-toggle-span">
              <a href="#" id="sidebar-toggle" title=' (CTRL+ALT+n)'><i class="fas fa-bars fa-fw"></i></a>
            </span>
            <ol class="links" itemscope itemtype="http://schema.org/BreadcrumbList">
              <li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><a itemprop="item" href="/docs-uan/index.html"><span itemprop="name">User Access Node (UAN)</span></a><meta itemprop="position" content="1"> > </li>
              <li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><a itemprop="item" href="/docs-uan/operations/index.html"><span itemprop="name">User Access Node (UAN)</span></a><meta itemprop="position" content="2"> > </li>
              <li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><span itemprop="name">User Access Node (UAN)</span><meta itemprop="position" content="3"></li>
            </ol>
          </div>
        </div>
      </nav>
      <main id="body-inner" class="highlightable default" tabindex="-1">
        <div class="flex-block-wrapper">
          <div id="head-tags">
          </div>
          <article class="default">
<h1 id=""></h1>

<h1 id="create-uan-boot-images">Create UAN Boot Images</h1>
<p>This procedure updates the configuration management git repository to match the installed version of the UAN product. That updated configuration is then used to create UAN boot images and a BOS session template.</p>
<p>UAN specific configuration, and other required configurations related to UANs are covered in this topic. Refer to <em>HPE Cray EX System Software Getting Started Guide</em> for further information on configuring other HPE products (for example, workload managers and the HPE Cray Programming Environment) that may be configured on the UANs.</p>
<p>This is the overall workflow for preparing UAN images to boot UANs:</p>
<ol>
<li>Clone the UAN configuration git repository and create a branch based on the branch imported by the UAN installation.</li>
<li>Update the configuration content and push the changes to the newly created branch.</li>
<li>Use Shasta Admin Toolkit (SAT) command <code>sat bootprep</code>, to automate the creation of IMS image, CFS configurations, and BOS session templates.</li>
</ol>
<p>Once the UAN BOS session template is created, the UANs will be ready to be booted by a BOS session.</p>
<p>Replace <code>PRODUCT_VERSION</code> and <code>CRAY_EX_HOSTNAME</code> in the example commands in this procedure with the current UAN product version installed (See Step 1) and the hostname of the HPE Cray EX system, respectively.</p>
<p><strong>PREPARE CFS CONFIGURATION</strong></p>
<ol>
<li>
<p>Obtain the artifact IDs and other information from the <code>cray-product-catalog</code> Kubernetes ConfigMap. Record the following information:</p>
<ul>
<li>the <code>clone_url</code></li>
<li>the <code>import_branch</code> value</li>
</ul>
<p>Upon successful installation of the UAN product, the UAN configuration is cataloged in this ConfigMap. This information is required for this procedure.</p>
<p><code>PRODUCT_VERSION</code> will be replaced by a numbered version string, such as <code>2.1.7</code> or <code>2.3.0</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ncn-m001# kubectl get cm -n services cray-product-catalog -o json | jq -r .data.uan
</span></span><span style="display:flex;"><span>PRODUCT_VERSION:
</span></span><span style="display:flex;"><span>  configuration:
</span></span><span style="display:flex;"><span>    clone_url: https://vcs.CRAY_EX_HOSTNAME/vcs/cray/uan-config-management.git 
</span></span><span style="display:flex;"><span>    commit: 6658ea9e75f5f0f73f78941202664e9631a63726                   
</span></span><span style="display:flex;"><span>    import_branch: cray/uan/PRODUCT_VERSION                           
</span></span><span style="display:flex;"><span>    import_date: 2021-02-02 19:14:18.399670
</span></span><span style="display:flex;"><span>    ssh_url: git@vcs.CRAY_EX_HOSTNAME:cray/uan-config-management.git                      
</span></span></code></pre></div></li>
<li>
<p><strong>Optional</strong> Generate the password hash for the <code>root</code> user. Replace PASSWORD with the <code>root</code> password you wish to use.  If an upgrade or image rebuild is being performed, the root password may have already been added to vault.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ncn-m001# openssl passwd -6 -salt <span style="color:#66d9ef">$(</span>&lt; /dev/urandom tr -dc _A-Z-a-z-0-9 | head -c4<span style="color:#66d9ef">)</span> PASSWORD
</span></span></code></pre></div></li>
<li>
<p><strong>Optional</strong> Obtain the HashiCorp Vault <code>root</code> token.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ncn-m001# kubectl get secrets -n vault cray-vault-unseal-keys -o jsonpath<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;{.data.vault-root}&#39;</span> | base64 -d; echo
</span></span></code></pre></div></li>
<li>
<p><strong>Optional</strong> Write the password hash obtained in Step 2 to the HashiCorp Vault.</p>
<p>The vault login command will request a token. That token value is the output of the previous step. The vault <code>read secret/uan</code> command verifies that the hash was stored correctly. This password hash will be written to the UAN for the <code>root</code> user by CFS.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ncn-m001# kubectl exec -it -n vault cray-vault-0 -c vault -- sh
</span></span><span style="display:flex;"><span>export VAULT_ADDR<span style="color:#f92672">=</span>http://cray-vault:8200
</span></span><span style="display:flex;"><span>vault login
</span></span><span style="display:flex;"><span>vault write secret/uan root_password<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;HASH&#39;</span>
</span></span><span style="display:flex;"><span>vault read secret/uan
</span></span></code></pre></div></li>
<li>
<p><strong>Optional</strong> Write any uan_ldap sensitive data, such as the <code>ldap_default_authtok</code> value, to the HashiCorp Vault.</p>
<p>The vault login command will request a token. That token value is the output of the Step 3. The vault <code>read secret/uan_ldap</code> command verifies that the <code>uan_ldap</code> data was stored correctly. Any values stored here will be written to the UAN <code>/etc/sssd/sssd.conf</code> file in the <code>[domain]</code> section by CFS.</p>
<p>This example shows storing a value for <code>ldap_default_authtok</code>.  If more than one variable needs to be stored, they must be written in space separated <code>key=value</code> pairs on the same <code>vault write secret/uan_ldap</code> command line.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ncn-m001# kubectl exec -it -n vault cray-vault-0 -- sh
</span></span><span style="display:flex;"><span>export VAULT_ADDR<span style="color:#f92672">=</span>http://cray-vault:8200
</span></span><span style="display:flex;"><span>vault login
</span></span><span style="display:flex;"><span>vault write secret/uan_ldap ldap_default_authtok<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;TOKEN&#39;</span>
</span></span><span style="display:flex;"><span>vault read secret/uan_ldap
</span></span></code></pre></div></li>
<li>
<p>Obtain the password for the <code>crayvcs</code> user from the Kubernetes secret for use in the next command.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ncn-m001# VCS_USER<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>kubectl get secret -n services vcs-user-credentials --template<span style="color:#f92672">={{</span>.data.vcs_username<span style="color:#f92672">}}</span> | base64 --decode<span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>          VCS_PASS<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>kubectl get secret -n services vcs-user-credentials --template<span style="color:#f92672">={{</span>.data.vcs_password<span style="color:#f92672">}}</span> | base64 --decode<span style="color:#66d9ef">)</span>
</span></span></code></pre></div></li>
<li>
<p>Clone the UAN configuration management repository. Replace CRAY_EX_HOSTNAME in the clone url with <strong>api-gw-service-nmn.local</strong> when cloning the repository.</p>
<p>The repository is in the VCS/Gitea service and the location is reported in the cray-product-catalog Kubernetes ConfigMap in the <code>configuration.clone_url</code> key. The CRAY_EX_HOSTNAME from the <code>clone_url</code> is replaced with <code>api-gw-service-nmn.local</code> in the command that clones the repository.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ncn-m001# git clone https://$VCS_USER:$VCS_PASS@api-gw-service-nmn.local/vcs/cray/uan-config-management.git
</span></span><span style="display:flex;"><span>. . .
</span></span><span style="display:flex;"><span>ncn-m001# cd uan-config-management <span style="color:#f92672">&amp;&amp;</span> git checkout cray/uan/PRODUCT_VERSION <span style="color:#f92672">&amp;&amp;</span> git pull
</span></span><span style="display:flex;"><span>Branch <span style="color:#e6db74">&#39;cray/uan/PRODUCT_VERSION&#39;</span> set up to track remote branch <span style="color:#e6db74">&#39;cray/uan/PRODUCT_VERSION&#39;</span> from <span style="color:#e6db74">&#39;origin&#39;</span>.
</span></span><span style="display:flex;"><span>Already up to date.
</span></span></code></pre></div></li>
<li>
<p>Create a branch using the imported branch from the installation to customize the UAN image.</p>
<p>This will be reported in the <code>cray-product-catalog</code> Kubernetes ConfigMap in the <code>configuration.import_branch</code> key under the UAN section. The format is cray/uan/PRODUCT_VERSION. In this guide, an <code>integration</code> branch is used for examples, but the name can be any valid git branch name.</p>
<p>Modifying the cray/uan/PRODUCT_VERSION branch that was created by the UAN product installation is not allowed by default.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ncn-m001# git checkout -b integration <span style="color:#f92672">&amp;&amp;</span> git merge cray/uan/PRODUCT_VERSION
</span></span><span style="display:flex;"><span>Switched to a new branch <span style="color:#e6db74">&#39;integration&#39;</span>
</span></span><span style="display:flex;"><span>Already up to date.
</span></span></code></pre></div></li>
<li>
<p>Apply any site-specific customizations and modifications to the Ansible configuration for the UAN nodes and commit the changes.</p>
<p>The default Ansible play to configure UAN nodes is <code>site.yml</code> in the base of the <code>uan-config-management</code> repository. The roles that are executed in this play allow for custom configuration as required for the system.</p>
<p>Consult the individual Ansible role <code>README.md</code> files in the uan-config-management repository roles directory to configure individual role variables. Roles prefixed with <code>uan_</code> are specific to UAN configuration and include network interfaces, disk, LDAP, software packages, and message of the day roles.</p>
<p><em><strong>NOTE:</strong></em> Admins <em><strong>must</strong></em> ensure the <code>uan_can_setup</code> variable is set to the correct value for the site.  This variable controls how the nodes are configured for user access. When <code>uan_can_setup</code> is <code>yes</code>, user access is over the <code>CAN</code> or <code>CHN</code>, based on the BICAN System Default Route setting in SLS.  When <code>uan_can_setup</code> is <code>no</code>, the Admin must configure the user access interface and default route. See <a href="/docs-uan/operations/configure_interfaces_on_uans/">Configure Interfaces on UANs</a></p>
<p><strong>Warning:</strong> Never place sensitive information such as passwords in the git repository.</p>
<p>The following example shows how to add a <code>vars.yml</code> file containing site-specific configuration values to the <code>Application_UAN</code> group variable location.</p>
<p>These and other Ansible files do not necessarily need to be modified for UAN image creation. See <a href="/docs-uan/operations/about_uan_configuration/#about-uan-configuration">About UAN Configuration</a> for instructions for site-specific UAN configuration, including CAN/CHN configuration.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ncn-m001# vim group_vars/Application_UAN/vars.yml
</span></span><span style="display:flex;"><span>ncn-m001# git add group_vars/Application_UAN/vars.yml
</span></span><span style="display:flex;"><span>ncn-m001# git commit -m <span style="color:#e6db74">&#34;Add vars.yml customizations&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>integration ecece54<span style="color:#f92672">]</span> Add vars.yml customizations
</span></span><span style="display:flex;"><span> <span style="color:#ae81ff">1</span> file changed, <span style="color:#ae81ff">1</span> insertion<span style="color:#f92672">(</span>+<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span> create mode <span style="color:#ae81ff">100644</span> group_vars/Application_UAN/vars.yml
</span></span></code></pre></div></li>
<li>
<p>Push the changes to the repository using the proper credentials, including the password obtained previously.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ncn-m001# git push --set-upstream origin integration
</span></span><span style="display:flex;"><span>Username <span style="color:#66d9ef">for</span> <span style="color:#e6db74">&#39;https://api-gw-service-nmn.local&#39;</span>: crayvcs
</span></span><span style="display:flex;"><span>Password <span style="color:#66d9ef">for</span> <span style="color:#e6db74">&#39;https://crayvcs@api-gw-service-nmn.local&#39;</span>:
</span></span><span style="display:flex;"><span>. . .
</span></span><span style="display:flex;"><span>remote: Processed <span style="color:#ae81ff">1</span> references in total
</span></span><span style="display:flex;"><span>To https://api-gw-service-nmn.local/vcs/cray/uan-config-management.git
</span></span><span style="display:flex;"><span> * <span style="color:#f92672">[</span>new branch<span style="color:#f92672">]</span>      integration -&gt; integration
</span></span><span style="display:flex;"><span> Branch <span style="color:#e6db74">&#39;integration&#39;</span> set up to track remote branch <span style="color:#e6db74">&#39;integration&#39;</span> from <span style="color:#e6db74">&#39;origin&#39;</span>.
</span></span></code></pre></div><p>The configuration parameters have been stored in a branch in the UAN git repository. The next phase of the process uses <code>sat bootprep</code> to handle creating the CFS configurations, IMS images, and BOS sessiontemplates for UANs.</p>
</li>
</ol>
<p><strong>CREATE UAN IMAGES</strong></p>
<p>With Shasta Admin Toolkit (SAT) version <code>2.2.16</code> and later, it is recommended that administrators create an input file for use with <code>sat bootprep</code>. Use the following command to determine which version of SAT is installed:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ncn-m001# sat showrev --products --filter <span style="color:#e6db74">&#39;product_name=&#34;sat&#34;&#39;</span>
</span></span></code></pre></div><p>A <code>sat bootprep</code> input file will have three sections: <code>configurations</code>, <code>images</code>, and <code>session_templates</code>. These sections create CFS configurations, IMS images, and BOS session templates respectively. Each section may have multiple elements to create more than one CFS, IMS, or BOS artifact. The format is similar to the input files for CFS, IMS, and BOS, but SAT will automate the process with fewer steps. Follow the subsections below to create a UAN bootprep input file.</p>
<p>Refer to <em>HPE Cray EX System Software Getting Started Guide</em> for further information on configuring other HPE products, as this procedure documents only the required configuration of the UAN.</p>
<p><strong>SAT Bootprep Configuration</strong></p>
<p>The SAT bootprep input file should have a configuration section that specifies each layer to be included in the CFS configuration for the UAN images for image customization and node personalization. This section will result in a CFS configuration named <code>uan-config</code>. The versions of each layer may be gathered using <code>sat showrev</code>.</p>
<p>Note that the Slingshot Host Software CFS layer is listed first. This is required as the UAN layer will attempt to install DVS and Lustre packages that require SHS be installed first. The correct playbook for Cassini or Mellanox must also be specified. Consult the Slingshot Host Software documentation for more information.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">configurations</span>:
</span></span><span style="display:flex;"><span>- <span style="color:#f92672">name</span>: <span style="color:#ae81ff">uan-config</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">layers</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">slingshot-host-software</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">playbook</span>: <span style="color:#ae81ff">shs_mellanox_install.yml</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">product</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">name</span>: <span style="color:#ae81ff">slingshot-host-software</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">version</span>: <span style="color:#ae81ff">2.0.0</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">branch</span>: <span style="color:#ae81ff">integration</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#ae81ff">... add configuration layers for other products here, if desired ...</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">uan</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">playbook</span>: <span style="color:#ae81ff">site.yml</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">product</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">name</span>: <span style="color:#ae81ff">uan</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">version</span>: <span style="color:#ae81ff">2.4.0</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">branch</span>: <span style="color:#ae81ff">integration</span>
</span></span></code></pre></div><p><strong>SAT Bootprep Image</strong></p>
<p>The SAT bootprep input file should have a section that specifies which IMS images to create for UAN nodes. UANs are built using the COS recipe, so the section below specifies which image recipe to use based on what is provided by COS. To determine which COS recipes are available run the following command:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ncn-m001# sat showrev --products --filter <span style="color:#e6db74">&#39;product_name=&#34;cos&#34;&#39;</span>
</span></span></code></pre></div><p>This example will create an IMS image with the name <code>cray-shasta-uan-sles15sp3.x86_64-2.3.25</code>. An appropriate name should be used to correctly identify the UAN image being built. Also note that the CFS configuration <code>uan-config</code> is being referenced so that CFS image customization will be run using that configuration along with the specified node groups.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">images</span>:
</span></span><span style="display:flex;"><span>- <span style="color:#f92672">name</span>: <span style="color:#ae81ff">cray-shasta-uan-sles15sp3.x86_64-2.3.25</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">ims</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">is_recipe</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">cray-shasta-compute-sles15sp3.x86_64-2.3.25</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">configuration</span>: <span style="color:#ae81ff">uan-config</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">configuration_group_names</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">Application</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">Application_UAN</span>
</span></span></code></pre></div><p><strong>SAT Bootprep Session Template</strong></p>
<p>The final section of the SAT bootprep input file creates BOS session templates. This section references the named IMS image that <code>sat bootprep</code> generates, as well as a CFS configuration. The boot_sets key &ldquo;uan&rdquo; may be changed as needed. If there are more than one boot_sets in the session template, each key will need to be unique.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">session_templates</span>:
</span></span><span style="display:flex;"><span>- <span style="color:#f92672">name</span>: <span style="color:#ae81ff">uan-2.4.0</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">image</span>: <span style="color:#ae81ff">cray-shasta-uan-sles15sp3.x86_64-2.3.25</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">configuration</span>: <span style="color:#ae81ff">uan-config</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">bos_parameters</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">boot_sets</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">uan</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">kernel_parameters</span>: <span style="color:#ae81ff">spire_join_token=${SPIRE_JOIN_TOKEN}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">node_roles_groups</span>:
</span></span><span style="display:flex;"><span>        - <span style="color:#ae81ff">Application_UAN</span>
</span></span></code></pre></div><p><strong>Run SAT Bootprep</strong></p>
<p>Initiate the <code>sat bootprep</code> command to generate the configurations and artifacts needed to boot UANs. This command may take some time as it will initiate IMS image creation and CFS image customization.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ncn-m001# sat bootprep run uan-bootprep.yaml
</span></span></code></pre></div><p>If changes are necessary to complete <code>sat bootprep</code> with the provided input file, make adjustments to the CFS layers or input file as needed and rerun the <code>sat bootprep</code> command. If any artifacts are going to be overwritten, SAT will prompt for confirmation before taking action. This is useful when making CFS changes as SAT will automatically configure the layers to use the latest git commits if the branches are specified correctly.</p>
<p>Once <code>sat bootprep</code> completes successfully, save the input file to a known location. This input file will be useful to regenerate artifacts as changes are made or different product layers are added.</p>
<p>Finally, perform <a href="/docs-uan/operations/boot_uans/#boot-uans">Boot UANs</a> to boot the UANs with the new BOS session template.</p>

            <footer class="footline">
            </footer>
          </article>
        </div>
      </main>
    </div>
    <aside id="sidebar" class="default-animation" dir="ltr">
      <div id="header-wrapper" class="default-animation">
        <div id="header" class="default-animation">
<a id="logo" href='/docs-uan/'>
  <img src="/docs-uan/images/hpe.png" alt="HPE" />
</a>
        </div>
        <div class="searchbox default-animation">
          <i class="fas fa-search" title=" (CTRL+ALT+f)"></i>
          <label class="a11y-only" for="search-by"></label>
          <input data-search-input id="search-by" name="search-by" class="search-by" type="search" placeholder="">
          <span data-search-clear=""><i class="fas fa-times"></i></span>
        </div>
        <script>
          var contentLangs=['en'];
        </script>
        <script src="/docs-uan/js/auto-complete.js?1670951100" defer></script>
        <script src="/docs-uan/js/lunr.min.js?1670951100" defer></script>
        <script src="/docs-uan/js/lunr.stemmer.support.min.js?1670951100" defer></script>
        <script src="/docs-uan/js/lunr.multi.min.js?1670951100" defer></script>
        <script src="/docs-uan/js/lunr.en.min.js?1670951100" defer></script>
        <script src="/docs-uan/js/search.js?1670951100" defer></script>
      </div>
      <div id="content-wrapper" class="highlightable">
        <ul class="topics">
          <li data-nav-id="/docs-uan/operations/index.html" class="dd-item parent"><a href="/docs-uan/operations/index.html">Operations</a><ul id="subsections-2793aa64e5a9807639f49b7448d0fca1">
          <li data-nav-id="/docs-uan/operations/create_uan_boot_images/index.html" class="dd-item active"><a href="/docs-uan/operations/create_uan_boot_images/index.html">Create UAN Boot Images</a></li></ul></li>
        </ul>
        <div class="footermargin footerLangSwitch footerVariantSwitch footerVisitedLinks footerFooter showFooter"></div>
        <hr class="default-animation footerLangSwitch footerVariantSwitch footerVisitedLinks footerFooter showFooter">
        <div id="prefooter" class="footerLangSwitch footerVariantSwitch footerVisitedLinks">
          <ul>
            <li id="select-language-container" class="footerLangSwitch">
              <div class="padding select-container">
                <i class="fas fa-language fa-fw"></i>
                <span>&nbsp;</span>
                <div class="select-style">
                  <label class="a11y-only" for="select-language"></label>
                  <select id="select-language" onchange="location = baseUri + this.value;">
                  </select>
                </div>
                <div class="select-clear"></div>
              </div>
            </li>
            <li id="select-variant-container" class="footerVariantSwitch">
              <div class="padding select-container">
                <i class="fas fa-paint-brush fa-fw"></i>
                <span>&nbsp;</span>
                <div class="select-style">
                  <label class="a11y-only" for="select-variant"></label>
                  <select id="select-variant" onchange="window.variants && variants.changeVariant( this.value );">
                    <option id="green" value="green" selected>Green</option>
                  </select>
                </div>
                <div class="select-clear"></div>
              </div>
              <script>window.variants && variants.markSelectedVariant();</script>
            </li>
            <li class="footerVisitedLinks"><button class="padding" onclick="clearHistory();"><i class="fas fa-history fa-fw"></i> </button></li>
          </ul>
        </div>
        <div id="footer" class="footerFooter showFooter">
	    <p>Built with <a href="https://github.com/McShelby/hugo-theme-relearn" title="love"><i class="fas fa-heart"></i></a> by <a href="https://gohugo.io/">Hugo</a></p>
        </div>
      </div>
    </aside>
    <script src="/docs-uan/js/clipboard.min.js?1670951100" defer></script>
    <script src="/docs-uan/js/perfect-scrollbar.min.js?1670951100" defer></script>
    <script src="/docs-uan/js/featherlight.min.js?1670951100" defer></script>
    <script src="/docs-uan/js/theme.js?1670951100" defer></script>
  </body>
</html>
